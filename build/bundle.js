var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function o(e){return e()}function i(){return Object.create(null)}function r(e){e.forEach(o)}function s(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(t,...n){if(null==t)return e;const o=t.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function a(e){let t;return c(e,(e=>t=e))(),t}function u(e,t,n){e.$$.on_destroy.push(c(t,n))}function d(e,t,n,o){if(e){const i=f(e,t,n,o);return e[0](i)}}function f(e,t,o,i){return e[1]&&i?n(o.ctx.slice(),e[1](i(t))):o.ctx}function p(e,t,n,o,i,r,s){const l=function(e,t,n,o){if(e[2]&&o){const i=e[2](o(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let o=0;o<n;o+=1)e[o]=t.dirty[o]|i[o];return e}return t.dirty|i}return t.dirty}(t,o,i,r);if(l){const i=f(t,n,o,s);e.p(i,l)}}function h(e,t,n=t){return e.set(n),t}const m="undefined"!=typeof window;let g=m?()=>window.performance.now():()=>Date.now(),$=m?e=>requestAnimationFrame(e):e;const y=new Set;function b(e){y.forEach((t=>{t.c(e)||(y.delete(t),t.f())})),0!==y.size&&$(b)}function x(e,t){e.appendChild(t)}function w(e,t,n){e.insertBefore(t,n||null)}function v(e){e.parentNode.removeChild(e)}function k(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function M(e){return document.createElement(e)}function S(e){return document.createTextNode(e)}function P(){return S(" ")}function _(){return S("")}function F(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function N(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function C(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function E(e,t){e.value=null==t?"":t}function R(e,t,n,o){e.style.setProperty(t,n,o?"important":"")}function T(e,t,n){e.classList[n?"add":"remove"](t)}function Y(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}const O=new Set;let X,D=0;function z(e,t,n,o,i,r,s,l=0){const c=16.666/o;let a="{\n";for(let e=0;e<=1;e+=c){const o=t+(n-t)*r(e);a+=100*e+`%{${s(o,1-o)}}\n`}const u=a+`100% {${s(n,1-n)}}\n}`,d=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${l}`,f=e.ownerDocument;O.add(f);const p=f.__svelte_stylesheet||(f.__svelte_stylesheet=f.head.appendChild(M("style")).sheet),h=f.__svelte_rules||(f.__svelte_rules={});h[d]||(h[d]=!0,p.insertRule(`@keyframes ${d} ${u}`,p.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${d} ${o}ms linear ${i}ms 1 both`,D+=1,d}function A(e,t){const n=(e.style.animation||"").split(", "),o=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),i=n.length-o.length;i&&(e.style.animation=o.join(", "),D-=i,D||$((()=>{D||(O.forEach((e=>{const t=e.__svelte_stylesheet;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.__svelte_rules={}})),O.clear())})))}function L(e){X=e}function J(){if(!X)throw new Error("Function called outside component initialization");return X}function q(e){J().$$.on_mount.push(e)}function j(){const e=J();return(t,n)=>{const o=e.$$.callbacks[t];if(o){const i=Y(t,n);o.slice().forEach((t=>{t.call(e,i)}))}}}function H(e,t){J().$$.context.set(e,t)}function I(e){return J().$$.context.get(e)}const G=[],W=[],B=[],U=[],Q=Promise.resolve();let K=!1;function V(e){B.push(e)}function Z(e){U.push(e)}let ee=!1;const te=new Set;function ne(){if(!ee){ee=!0;do{for(let e=0;e<G.length;e+=1){const t=G[e];L(t),oe(t.$$)}for(L(null),G.length=0;W.length;)W.pop()();for(let e=0;e<B.length;e+=1){const t=B[e];te.has(t)||(te.add(t),t())}B.length=0}while(G.length);for(;U.length;)U.pop()();K=!1,ee=!1,te.clear()}}function oe(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(V)}}let ie;function re(e,t,n){e.dispatchEvent(Y(`${t?"intro":"outro"}${n}`))}const se=new Set;let le;function ce(){le={r:0,c:[],p:le}}function ae(){le.r||r(le.c),le=le.p}function ue(e,t){e&&e.i&&(se.delete(e),e.i(t))}function de(e,t,n,o){if(e&&e.o){if(se.has(e))return;se.add(e),le.c.push((()=>{se.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}}const fe={duration:0};function pe(n,o,i,l){let c=o(n,i),a=l?0:1,u=null,d=null,f=null;function p(){f&&A(n,f)}function h(e,t){const n=e.b-a;return t*=Math.abs(n),{a:a,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function m(o){const{delay:i=0,duration:s=300,easing:l=t,tick:m=e,css:x}=c||fe,w={start:g()+i,b:o};o||(w.group=le,le.r+=1),u||d?d=w:(x&&(p(),f=z(n,a,o,s,i,l,x)),o&&m(0,1),u=h(w,s),V((()=>re(n,o,"start"))),function(e){let t;0===y.size&&$(b),new Promise((n=>{y.add(t={c:e,f:n})}))}((e=>{if(d&&e>d.start&&(u=h(d,s),d=null,re(n,u.b,"start"),x&&(p(),f=z(n,a,u.b,u.duration,0,l,c.css))),u)if(e>=u.end)m(a=u.b,1-a),re(n,u.b,"end"),d||(u.b?p():--u.group.r||r(u.group.c)),u=null;else if(e>=u.start){const t=e-u.start;a=u.a+u.d*l(t/u.duration),m(a,1-a)}return!(!u&&!d)})))}return{run(e){s(c)?(ie||(ie=Promise.resolve(),ie.then((()=>{ie=null}))),ie).then((()=>{c=c(),m(e)})):m(e)},end(){p(),u=d=null}}}const he="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function me(e,t,n){const o=e.$$.props[t];void 0!==o&&(e.$$.bound[o]=n,n(e.$$.ctx[o]))}function ge(e){e&&e.c()}function $e(e,t,n){const{fragment:i,on_mount:l,on_destroy:c,after_update:a}=e.$$;i&&i.m(t,n),V((()=>{const t=l.map(o).filter(s);c?c.push(...t):r(t),e.$$.on_mount=[]})),a.forEach(V)}function ye(e,t){const n=e.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function be(e,t){-1===e.$$.dirty[0]&&(G.push(e),K||(K=!0,Q.then(ne)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function xe(t,n,o,s,l,c,a=[-1]){const u=X;L(t);const d=n.props||{},f=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:l,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:i(),dirty:a,skip_bound:!1};let p=!1;if(f.ctx=o?o(t,d,((e,n,...o)=>{const i=o.length?o[0]:n;return f.ctx&&l(f.ctx[e],f.ctx[e]=i)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](i),p&&be(t,e)),n})):[],f.update(),p=!0,r(f.before_update),f.fragment=!!s&&s(f.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);f.fragment&&f.fragment.l(e),e.forEach(v)}else f.fragment&&f.fragment.c();n.intro&&ue(t.$$.fragment),$e(t,n.target,n.anchor),ne()}L(u)}class we{$destroy(){ye(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function ve(e){const t=e-1;return t*t*t+1}function ke(e,{delay:n=0,duration:o=400,easing:i=t}){const r=+getComputedStyle(e).opacity;return{delay:n,duration:o,easing:i,css:e=>"opacity: "+e*r}}function Me(e,{delay:t=0,duration:n=400,easing:o=ve,x:i=0,y:r=0,opacity:s=0}){const l=getComputedStyle(e),c=+l.opacity,a="none"===l.transform?"":l.transform,u=c*(1-s);return{delay:t,duration:n,easing:o,css:(e,t)=>`\n\t\t\ttransform: ${a} translate(${(1-e)*i}px, ${(1-e)*r}px);\n\t\t\topacity: ${c-u*t}`}}const Se=[];function Pe(t,n=e){let o;const i=[];function r(e){if(l(t,e)&&(t=e,o)){const e=!Se.length;for(let e=0;e<i.length;e+=1){const n=i[e];n[1](),Se.push(n,t)}if(e){for(let e=0;e<Se.length;e+=2)Se[e][0](Se[e+1]);Se.length=0}}}return{set:r,update:function(e){r(e(t))},subscribe:function(s,l=e){const c=[s,l];return i.push(c),1===i.length&&(o=n(r)||e),s(t),()=>{const e=i.indexOf(c);-1!==e&&i.splice(e,1),0===i.length&&(o(),o=null)}}}}function _e(t,n,o){const i=!Array.isArray(t),l=i?[t]:t,a=n.length<2;return{subscribe:Pe(o,(t=>{let o=!1;const u=[];let d=0,f=e;const p=()=>{if(d)return;f();const o=n(i?u[0]:u,t);a?t(o):f=s(o)?o:e},h=l.map(((e,t)=>c(e,(e=>{u[t]=e,d&=~(1<<t),o&&p()}),(()=>{d|=1<<t}))));return o=!0,p(),function(){r(h),f()}})).subscribe}}const Fe=Pe({id:-1});const Ne=Pe({message:"",timeout:{}});function Ce(e){Ne.update((t=>(t.message=e,t.timeout&&clearTimeout(t.timeout),e&&(t.timeput=setInterval(Ee,5e3)),t)))}function Ee(){Ce("")}const Re="vast-cliffs-53607.herokuapp.com";let Te;function Ye(e){return new Promise((function(t,n){let o=new XMLHttpRequest;o.onload=function(){var e=o.status;200==e?t(JSON.parse(o.responseText)):n(e)},o.onerror=function(e){t({isError:!0,error:"The Server seems to be offline."})},o.open("POST",`https://${Re}`,!0),o.setRequestHeader("Content-type","application/json"),o.send(e)}))}function Oe(e,t){Te=new WebSocket(`wss://${Re}/websocket`),Te.onopen=function(){let n={action:"register",pid:t,gid:e};Te.send(JSON.stringify(n))},Te.onmessage=function(e){let t=JSON.parse(e.data);if(t.isError&&Ce(t.message),"ping"!=t.action&&console.log(t),"userJoined"===t.action)s=t.user,Fe.update((e=>(e.playerNames.push(s),e)));else if("showRoom"===t.action)r=t.room,Fe.update((e=>(e.thisPlayer.isMaster?e.dungeon.rects.find((e=>e.x==r.x&&e.y==r.y&&e.w==r.w&&e.h==r.h)).visible=r.visible:e.dungeon.rects=[...e.dungeon.rects,r],e)));else if("showDoor"===t.action)!function(e){Fe.update((t=>(t.thisPlayer.isMaster||(t.dungeon.doors=[...t.dungeon.doors,e]),t)))}(t.door);else if("kick"===t.action)Te&&Te.close(),Fe.set({id:-1}),Ce("You were kicked: "+t.message);else if("ping"===t.action){let e=a(Fe).id,t={action:"pong",pid:a(Fe).thisPlayer.id,gid:e};Te.send(JSON.stringify(t))}else"userLeft"===t.action?(i=t.user,Fe.update((e=>{let t=e.playerNames.findIndex((e=>e.name===i.name));return t>0&&e.playerNames.splice(t,1),e}))):"hideDoor"===t.action?(o=t.door,Fe.update((e=>{if(!e.thisPlayer.isMaster){let t=e.dungeon.doors.findIndex((e=>e.x===o.x&&e.y===o.y));t>=0&&e.dungeon.doors.splice(t,1)}return e}))):"hideRoom"===t.action?function(e){Fe.update((t=>{if(t.thisPlayer.isMaster)t.dungeon.rects.find((t=>t.x==e.x&&t.y==e.y&&t.w==e.w&&t.h==e.h)).visible=e.visible;else{let n=t.dungeon.rects.findIndex((t=>t.x==e.x&&t.y==e.y&&t.w==e.w&&t.h==e.h));n>=0&&t.dungeon.rects.splice(n,1)}return t}))}(t.room):"addFigure"===t.action?(n=t.figure,Fe.update((e=>(e.dungeon.figures.push(n),e)))):"moveFigure"===t.action?function(e,t){Fe.update((n=>{let o=n.dungeon.figures.find((t=>t.x===e.x&&t.y===e.y));return o.x=t.x,o.y=t.y,n}))}(t.figure,t.to):"removeFigure"===t.action&&function(e){Fe.update((t=>{let n=t.dungeon.figures.findIndex((t=>t.x===e.x&&t.y===e.y));return n>=0&&t.dungeon.figures.splice(n,1),t}))}(t.figure);var n,o,i,r,s}}function Xe(t){let n;return{c(){n=M("div"),n.innerHTML='<div class="row"><div class="col"><span>This site is used for playing dungeons generated by <a href="https://watabou.itch.io/one-page-dungeon">Watabou&#39;s One Page Dungeon Generator</a>.<br/>\n        Simply create an room, upload the .json file, which contains the dungeon and copy and share the link with your friends.<br/>\n        As the creator of the room, you can decide which rooms your player can see. You can also spawn figures for them, which they can move.<br/>  <br/> \n        <b>Q: The map is too big for my screen. What can I do? </b><br/>\n        A: You can drag the map whith the left mouse button to scroll around.<br/> \n        <b>Q: I scrolled to far away. How can i get back to the map? </b><br/>\n        A: Right click anywhere on the map and press &quot;Reset Camera&quot;.<br/> \n        <b>Q: The game is just loading and does&#39;nt seem to end. </b><br/>\n        A: That&#39;s because the server synchronizing your games has to wake up. Just give him some time.<br/></span></div> \n    <div class="hide-xs"><hr class="vertical svelte-lfqs6x"/></div> \n    <div class="col"><b>Source</b><br/> \n      <span>[1] <a href="https://watabou.itch.io/one-page-dungeon">Watabou&#39;s One Page Dungeon Generator </a></span><br/> \n      <b>Tools Used</b><br/> \n      <span>[2] <a href="https://svelte.dev">Svelte </a></span><br/> \n      <span>[3] <a href="https://jenil.github.io/chota/">chota </a></span><br/> \n      <span>[4] <a href="https://loading.io/animation/">Loading.css </a></span><br/> \n      <span>[5] <a href="https://heroku.com/">Heroku </a></span><br/> \n      <span>[6] <a href="https://www.npmjs.com/package/uuid">uuid </a></span><br/> \n      <span>[7] <a href="https://www.npmjs.com/package/ws">ws: a Node.js WebSocket library </a></span><br/> \n      <span>[8] <a href="https://svelte.dev/repl/79f4f3e0296a403ea988f74d332a7a4a?version=3.12.1">Canvas 2D Game Engine </a></span><br/> \n      <span>[9] <a href="https://svelte.dev/repl/3a33725c3adb4f57b46b597f9dade0c1?version=3.25.0">Context Menu </a></span><br/></div></div>'},m(e,t){w(e,n,t)},p:e,i:e,o:e,d(e){e&&v(n)}}}class De extends we{constructor(e){super(),xe(this,e,null,Xe,l,{})}}function ze(e){let t,n,o;return{c(){t=M("div"),t.innerHTML='<div class="ld ld-ring ld-spin svelte-fwrzh4"></div>',N(t,"class","svelte-fwrzh4")},m(e,n){w(e,t,n),o=!0},i(e){o||(V((()=>{n||(n=pe(t,Me,{x:-15,duration:100},!0)),n.run(1)})),o=!0)},o(e){n||(n=pe(t,Me,{x:-15,duration:100},!1)),n.run(0),o=!1},d(e){e&&v(t),e&&n&&n.end()}}}function Ae(e){let t,n,o;return{c(){t=M("div"),t.innerHTML='<div class="ld ld-ring ld-spin svelte-fwrzh4"></div>',N(t,"class","svelte-fwrzh4")},m(e,n){w(e,t,n),o=!0},i(e){o||(V((()=>{n||(n=pe(t,Me,{x:-15,duration:100},!0)),n.run(1)})),o=!0)},o(e){n||(n=pe(t,Me,{x:-15,duration:100},!1)),n.run(0),o=!1},d(e){e&&v(t),e&&n&&n.end()}}}function Le(e){let t,n,o,i,s,l,c,a,u,d,f,p,h,m,g,$,y,b,k,S,_,C,R,T,Y,O,X,D,z,A,L=2==e[2]&&ze(),J=1==e[2]&&Ae();return Y=new De({}),{c(){t=M("div"),n=M("div"),o=M("div"),i=M("div"),s=M("input"),l=P(),c=M("div"),a=M("div"),u=M("input"),d=P(),f=M("div"),p=M("button"),h=M("span"),h.textContent="Join",m=P(),g=M("span"),g.textContent=" Game",$=P(),L&&L.c(),y=P(),b=M("div"),k=M("button"),S=M("span"),S.textContent="Create",_=P(),C=M("span"),C.textContent=" Game",R=P(),J&&J.c(),T=P(),ge(Y.$$.fragment),O=P(),X=M("div"),X.innerHTML="<span>v1.1</span>",N(s,"placeholder","Enter Game Name"),N(s,"class","is-rounded"),s.disabled=e[2],N(i,"class","col"),N(o,"class","row"),N(u,"placeholder","Enter your Name"),N(u,"class","is-rounded"),u.disabled=e[2],N(a,"class","col"),N(g,"class","hide-sm"),N(p,"class","button is-full-width svelte-fwrzh4"),p.disabled=e[2],N(f,"class","col-2"),N(C,"class","hide-sm"),N(k,"class","button primary is-full-width svelte-fwrzh4"),k.disabled=e[2],N(b,"class","col-2"),N(c,"class","row"),N(n,"class","card svelte-fwrzh4"),N(t,"class","main svelte-fwrzh4"),N(X,"class","version svelte-fwrzh4")},m(r,v){w(r,t,v),x(t,n),x(n,o),x(o,i),x(i,s),E(s,e[0]),x(n,l),x(n,c),x(c,a),x(a,u),E(u,e[1]),x(c,d),x(c,f),x(f,p),x(p,h),x(p,m),x(p,g),x(p,$),L&&L.m(p,null),x(c,y),x(c,b),x(b,k),x(k,S),x(k,_),x(k,C),x(k,R),J&&J.m(k,null),x(t,T),$e(Y,t,null),w(r,O,v),w(r,X,v),D=!0,z||(A=[F(s,"input",e[5]),F(u,"input",e[6]),F(p,"click",e[4]),F(k,"click",e[3])],z=!0)},p(e,[t]){(!D||4&t)&&(s.disabled=e[2]),1&t&&s.value!==e[0]&&E(s,e[0]),(!D||4&t)&&(u.disabled=e[2]),2&t&&u.value!==e[1]&&E(u,e[1]),2==e[2]?L?4&t&&ue(L,1):(L=ze(),L.c(),ue(L,1),L.m(p,null)):L&&(ce(),de(L,1,1,(()=>{L=null})),ae()),(!D||4&t)&&(p.disabled=e[2]),1==e[2]?J?4&t&&ue(J,1):(J=Ae(),J.c(),ue(J,1),J.m(k,null)):J&&(ce(),de(J,1,1,(()=>{J=null})),ae()),(!D||4&t)&&(k.disabled=e[2])},i(e){D||(ue(L),ue(J),ue(Y.$$.fragment,e),D=!0)},o(e){de(L),de(J),de(Y.$$.fragment,e),D=!1},d(e){e&&v(t),L&&L.d(),J&&J.d(),ye(Y),e&&v(O),e&&v(X),z=!1,r(A)}}}function Je(e,t,n){let o;u(e,Fe,(e=>n(7,o=e)));const i=window.location.search,r=new URLSearchParams(i);r.set("test",4);let s=r.get("gid"),l="",c=0;return[s,l,c,async function(){n(2,c=1);let e=await function(e,t){let n={action:"createGame",gameName:e,masterName:t};return Ye(JSON.stringify(n))}(s,l);n(2,c=0),e.isError?Ce(e.error):(h(Fe,o={id:e.game.id,name:e.game.name,playerNames:[{name:l,isMaster:!0,isYou:!0}],thisPlayer:{id:e.player.id,name:l,isMaster:!0,isYou:!0},dungeon:e.dungeon},o),Oe(o.id,o.thisPlayer.id),Ee())},async function(){n(2,c=2);let e=await function(e,t){let n={action:"joinGame",gameID:e,playerName:t};return Ye(JSON.stringify(n))}(s,l);n(2,c=0),e.isError?Ce(e.error):(h(Fe,o={id:e.id,name:e.gameName,playerNames:e.player,thisPlayer:{id:e.playerID,name:l,isMaster:!1,isYou:!0},dungeon:e.dungeon},o),Oe(o.id,o.thisPlayer.id),Ee())},function(){s=this.value,n(0,s)},function(){l=this.value,n(1,l)}]}class qe extends we{constructor(e){super(),xe(this,e,Je,Le,l,{})}}let je=Pe({screenX:0,screenY:0,worldX:0,worldY:0,tileX:0,tileY:0,entered:!0,pick:!1,down:0});const He=Pe(window.innerWidth),Ie=Pe(window.innerHeight),Ge=Pe(window.devicePixelRatio),We=Pe(),Be=Pe(),Ue=Pe({dx:0,dy:0}),Qe=Pe(0),Ke=Pe(32),Ve=Pe({background:"#0E0E0E",rooms:"#EEEEEE",lastFigureColors:[]}),Ze=function(e){const t=Object.keys(e);return _e(t.map((t=>e[t])),(e=>e.reduce(((e,n,o)=>(e[t[o]]=n,e)),{})))}({context:We,canvas:Be,width:He,height:Ie,pixelRatio:Ge,time:Qe}),et=Symbol(),tt=e=>{const t=I(et),n={ready:!1,mounted:!1};"function"==typeof e?(n.render=e,n.height=0):e&&(e.render&&(n.render=e.render),e.setup&&(n.setup=e.setup),e.height&&(n.height=e.height)),t.add(n),q((()=>(n.mounted=!0,()=>{t.remove(n),n.mounted=!1})))};const{window:nt}=he;function ot(e){let t,n,o,i,l,c,a;const u=e[12].default,f=d(u,e,e[11],null);return{c(){t=M("canvas"),i=P(),f&&f.c(),N(t,"width",n=e[3]*e[1]),N(t,"height",o=e[4]*e[1]),R(t,"width",e[3]+"px"),R(t,"height",e[4]+"px")},m(n,o){w(n,t,o),e[13](t),w(n,i,o),f&&f.m(n,o),l=!0,c||(a=[F(nt,"resize",e[5],{passive:!0}),F(t,"mousemove",e[7]),F(t,"mousedown",e[8]),F(t,"mouseup",e[6]),F(t,"mouseenter",(function(){s(e[2].enter=!0)&&(e[2].enter=!0).apply(this,arguments)})),F(t,"mouseleave",(function(){s(e[2].enter=!1)&&(e[2].enter=!1).apply(this,arguments)}))],c=!0)},p(i,[r]){e=i,(!l||10&r&&n!==(n=e[3]*e[1]))&&N(t,"width",n),(!l||18&r&&o!==(o=e[4]*e[1]))&&N(t,"height",o),(!l||8&r)&&R(t,"width",e[3]+"px"),(!l||16&r)&&R(t,"height",e[4]+"px"),f&&f.p&&2048&r&&p(f,u,e,e[11],r,null,null)},i(e){l||(ue(f,e),l=!0)},o(e){de(f,e),l=!1},d(n){n&&v(t),e[13](null),n&&v(i),f&&f.d(n),c=!1,r(a)}}}function it(e,t,n){let o,i,r,s,l,c,a,d;u(e,Ze,(e=>n(17,o=e))),u(e,Ue,(e=>n(18,i=e))),u(e,Ge,(e=>n(1,r=e))),u(e,je,(e=>n(2,s=e))),u(e,Fe,(e=>n(19,l=e))),u(e,Ke,(e=>n(20,c=e))),u(e,He,(e=>n(3,a=e))),u(e,Ie,(e=>n(4,d=e)));let f,p,m,g,{$$slots:$={},$$scope:y}=t,{killLoopOnError:b=!0}=t,{attributes:x={}}=t,w=[];q((()=>(m=p.getContext("2d",x),Be.set(p),We.set(m),function(e){let t=0,n=performance.now();return function o(){g=requestAnimationFrame(o);const i=performance.now(),r=(i-n)/1e3;n=i,t+=r,e(t,r)}(),()=>{cancelAnimationFrame(g)}}(((e,t)=>{Qe.set(e),function(e){m.save(),m.translate(-i.dx,-i.dy),m.scale(r,r),w.forEach((t=>{try{t.mounted&&t.ready&&t.render&&t.render(o,e)}catch(e){console.error(e),b&&(cancelAnimationFrame(g),console.warn("Animation loop stopped due to an error"))}})),m.restore()}(t)}))))),H(et,{add(e){if(this.remove(e),w.push(e),e.setup){let t=e.setup(o);t&&t.then}e.ready=!0,w.sort(((e,t)=>e.height-t.height))},remove(e){const t=w.indexOf(e);t>=0&&w.splice(t,1)}});const v=j();return e.$$set=e=>{"killLoopOnError"in e&&n(9,b=e.killLoopOnError),"attributes"in e&&n(10,x=e.attributes),"$$scope"in e&&n(11,y=e.$$scope)},[p,r,s,a,d,function(){He.set(window.innerWidth),Ie.set(window.innerHeight),Ge.set(window.devicePixelRatio)},function(e){h(je,s.down=!1,s);let t=Date.now()-f,n={x:s.worldX,y:s.worldY,tileX:s.tileX,tileY:s.tileY},o=!1;if(s.pick){let e=s.pick.x,t=(s.pick.y,Math.round(2*s.tileX)/2-.5),n=Math.round(2*s.tileY)/2-.5;o=!(e===t&&s.pick.y===n),o&&function(e,t,n,o){let i={action:"moveFigure",pid:o,gid:n,figure:e,to:t},r=JSON.stringify(i);Te&&Te.send(r)}(s.pick,{x:t,y:n},l.id,l.thisPlayer.id),h(je,s.pick=!1,s)}t<200&&!o&&0===e.button&&v("click",n)},function(e){s.enter&&(s.down&&(s.pick||h(Ue,i={dx:i.dx+(s.screenX-e.x)*r,dy:i.dy+(s.screenY-e.y)*r},i)),h(je,s.screenX=e.x,s),h(je,s.screenY=e.y,s),h(je,s.worldX=e.x+i.dx/r,s),h(je,s.worldY=e.y+i.dy/r,s),h(je,s.tileX=s.worldX/c,s),h(je,s.tileY=s.worldY/c,s))},function(e){h(je,s.down=!0,s),f=Date.now(),0===e.button&&v("down",e)},b,x,y,$,function(e){W[e?"unshift":"push"]((()=>{p=e,n(0,p)}))}]}class rt extends we{constructor(e){super(),xe(this,e,it,ot,l,{killLoopOnError:9,attributes:10})}}function st(e){let t;const n=e[2].default,o=d(n,e,e[1],null);return{c(){o&&o.c()},m(e,n){o&&o.m(e,n),t=!0},p(e,[t]){o&&o.p&&2&t&&p(o,n,e,e[1],t,null,null)},i(e){t||(ue(o,e),t=!0)},o(e){de(o,e),t=!1},d(e){o&&o.d(e)}}}function lt(e,t,n){let o,i,r,s;u(e,Ve,(e=>n(3,o=e))),u(e,Ge,(e=>n(4,i=e))),u(e,Ue,(e=>n(5,r=e))),u(e,Ke,(e=>n(6,s=e)));let{$$slots:l={},$$scope:c}=t,{color:a=o.background+"6"}=t;return tt({render:e=>{const{context:t,width:n,height:o}=e;t.save();let l=i,c=r.dx/l,u=r.dy/l,d=n,f=o,p=c/s;p=p<0?Math.floor(p):Math.ceil(p);let h=u/s;h=h<0?Math.floor(h):Math.ceil(h);for(let e=Math.min(0,p);e<Math.max(0,p)+d/s;e++)t.beginPath(),t.strokeStyle=a,t.moveTo(e*s,u),t.lineTo(e*s,f+u),t.stroke();for(let e=Math.min(0,h);e<Math.max(0,h)+f/s;e++)t.beginPath(),t.strokeStyle=a,t.moveTo(c,e*s),t.lineTo(c+d,e*s),t.stroke();t.restore()},height:3}),e.$$set=e=>{"color"in e&&n(0,a=e.color),"$$scope"in e&&n(1,c=e.$$scope)},[a,c,l]}class ct extends we{constructor(e){super(),xe(this,e,lt,st,l,{color:0})}}function at(e){let t;const n=e[1].default,o=d(n,e,e[0],null);return{c(){o&&o.c()},m(e,n){o&&o.m(e,n),t=!0},p(e,[t]){o&&o.p&&1&t&&p(o,n,e,e[0],t,null,null)},i(e){t||(ue(o,e),t=!0)},o(e){de(o,e),t=!1},d(e){o&&o.d(e)}}}function ut(e,t,n){let o,i,r;u(e,Ve,(e=>n(2,o=e))),u(e,Ge,(e=>n(3,i=e))),u(e,Ue,(e=>n(4,r=e)));let{$$slots:s={},$$scope:l}=t,c=o.background+"F";return tt((e=>{const{context:t,width:n,height:o}=e;t.save();let s=i;t.clearRect(r.dx/s,r.dy/s,n,o),c&&(t.fillStyle=c,t.fillRect(r.dx/s,r.dy/i,n,o)),t.restore()})),e.$$set=e=>{"$$scope"in e&&n(0,l=e.$$scope)},[l,s]}class dt extends we{constructor(e){super(),xe(this,e,ut,at,l,{})}}function ft(e,t,n){let o,i;u(e,Ke,(e=>n(1,o=e))),u(e,Ve,(e=>n(2,i=e)));let{dimension:r}=t;return tt({render:(e,t)=>{const{context:n,width:s,height:l}=e;if(n.save(),r){let e=r.x*o,t=r.y*o,s=r.w*o,l=r.h*o;r.rotunda?(n.beginPath(),n.fillStyle=i.rooms,n.ellipse(e+s/2,t+l/2,s/2,l/2,0,0,2*Math.PI),n.closePath(),n.fill(),n.beginPath(),r.visible||(n.fillStyle=r.visible?"#0F06":"#F006",n.ellipse(e+s/2,t+l/2,s/2,l/2,0,0,2*Math.PI),n.closePath(),n.fill())):(n.fillStyle=i.rooms,n.fillRect(e,t,s,l),r.visible||(n.fillStyle=r.visible?"#0F06":"#F006",n.fillRect(e,t,s,l)))}n.restore()},height:1}),e.$$set=e=>{"dimension"in e&&n(0,r=e.dimension)},[r]}class pt extends we{constructor(e){super(),xe(this,e,ft,null,l,{dimension:0})}}function ht(e){let t;const n=e[5].default,o=d(n,e,e[4],null);return{c(){o&&o.c()},m(e,n){o&&o.m(e,n),t=!0},p(e,[t]){o&&o.p&&16&t&&p(o,n,e,e[4],t,null,null)},i(e){t||(ue(o,e),t=!0)},o(e){de(o,e),t=!1},d(e){o&&o.d(e)}}}function mt(e,t,n){let o,i;u(e,Ve,(e=>n(6,o=e))),u(e,Ke,(e=>n(7,i=e)));let{$$slots:r={},$$scope:s}=t,{baseline:l="middle"}=t,{pos:c}=t,{fontSize:a=16}=t,{fontFamily:d='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica'}=t;return tt({render:e=>{const{context:t,width:n,height:r}=e;if(c.name){t.font=`${a}px ${d}`,t.textBaseline=l;let e=t.measureText(c.name).width;t.fillStyle=o.rooms,t.fillRect(c.x*i+i/2-e/2-2,c.y*i+i-4-2,e+4,a+4),t.fillStyle=o.background+"FF",t.fillText(c.name,c.x*i+i/2-e/2,c.y*i+i-4)}},height:6}),e.$$set=e=>{"baseline"in e&&n(0,l=e.baseline),"pos"in e&&n(1,c=e.pos),"fontSize"in e&&n(2,a=e.fontSize),"fontFamily"in e&&n(3,d=e.fontFamily),"$$scope"in e&&n(4,s=e.$$scope)},[l,c,a,d,s,r]}class gt extends we{constructor(e){super(),xe(this,e,mt,ht,l,{baseline:0,pos:1,fontSize:2,fontFamily:3})}}function $t(e){let t,n,o;function i(t){e[1].call(null,t)}let r={fontSize:16,baseline:"top"};return void 0!==e[0]&&(r.pos=e[0]),t=new gt({props:r}),W.push((()=>me(t,"pos",i))),{c(){ge(t.$$.fragment)},m(e,n){$e(t,e,n),o=!0},p(e,[o]){const i={};!n&&1&o&&(n=!0,i.pos=e[0],Z((()=>n=!1))),t.$set(i)},i(e){o||(ue(t.$$.fragment,e),o=!0)},o(e){de(t.$$.fragment,e),o=!1},d(e){ye(t,e)}}}function yt(e,t,n){let o;u(e,Ke,(e=>n(2,o=e)));let{pos:i}=t;return tt({render:(e,t)=>{const{context:n,width:r,height:s}=e;n.save();let l=i.x*o,c=i.y*o,a=o-8,u=o-8;n.beginPath(),n.fillStyle=i.color,n.ellipse(l+o/2,c+o/2,a/2,u/2,0,0,2*Math.PI),n.closePath(),n.fill(),n.beginPath(),n.restore()},height:7}),e.$$set=e=>{"pos"in e&&n(0,i=e.pos)},[i,function(e){i=e,n(0,i)}]}class bt extends we{constructor(e){super(),xe(this,e,yt,$t,l,{pos:0})}}function xt(e,t,n){let o;u(e,Ke,(e=>n(2,o=e)));let{color:i="#F8F8F4"}=t,{dimension:r}=t;return tt({render:(e,t)=>{const{context:n,width:i,height:s}=e;n.save(),r&&(n.strokeStyle="#FF0",n.lineWidth=3,n.strokeRect(r.x*o,r.y*o,r.w*o,r.h*o),n.lineWidth=1),n.restore()},height:4}),e.$$set=e=>{"color"in e&&n(0,i=e.color),"dimension"in e&&n(1,r=e.dimension)},[i,r]}class wt extends we{constructor(e){super(),xe(this,e,xt,null,l,{color:0,dimension:1})}}function vt(e,t,n){let o,i;u(e,Ve,(e=>n(1,o=e))),u(e,Ke,(e=>n(2,i=e)));let{dimension:r}=t;function s(e){e.fillStyle=o.background;let t=r.x*i,n=r.y*i,s=i,l=i;1==Math.abs(r.dir.y)?(l/=2,n+=l/2,s=i/8):(s/=2,t+=s/2,l=i/8),e.fillRect(t,n,s,l),1==Math.abs(r.dir.y)?t+=i-s:n+=i-l,e.fillRect(t,n,s,l)}function l(e,t){e.strokeStyle=o.background;let n=r.x*i,s=r.y*i,l=i,c=i;1==t?(1==Math.abs(r.dir.y)?(c/=4,s+=1.5*c):(l/=4,n+=1.5*l),e.strokeRect(n,s,l,c)):5==t&&(1==Math.abs(r.dir.y)?(c/=4,s+=1.5*c,l/=2):(l/=4,n+=1.5*l,c/=2),e.strokeRect(n,s,l,c),1==Math.abs(r.dir.y)?n+=l:s+=c,e.strokeRect(n,s,l,c))}function c(e){e.fillStyle=o.background;let t=r.x*i,n=r.y*i,s=.8*i,l=i/5;if(1==Math.abs(r.dir.x)){-1==r.dir.x&&(t+=i,l*=-1);for(let o=0;o<4;o++)t+=l,e.moveTo(t,n+(i-s)/2),e.lineTo(t,n+(i-s)/2+s),s*=.8}else if(1==Math.abs(r.dir.y)){-1==r.dir.y&&(n+=i,l*=-1);for(let o=0;o<4;o++)n+=l,e.moveTo(t+(i-s)/2,n),e.lineTo(t+(i-s)/2+s,n),s*=.8}e.stroke()}return tt({render:(e,t)=>{const{context:n,width:a,height:u}=e;n.save(),r&&r.type>0&&(1==r.type?(s(n),l(n,1)):2==r.type?s(n):3==r.type?c(n):4==r.type||(5==r.type?(s(n),l(n,5)):6==r.type?function(e){e.fillStyle=o.background;let t=r.x*i,n=r.y*i,s=i,l=i;1==Math.abs(r.dir.y)?(l/=2,-1==r.dir.y&&(n+=l)):(s/=2,-1==r.dir.x&&(t+=s));e.fillRect(t,n,s,l)}(n):7==r.type?(s(n),l(n,1)):8==r.type&&c(n))),n.restore()},height:2}),e.$$set=e=>{"dimension"in e&&n(0,r=e.dimension)},[r]}class kt extends we{constructor(e){super(),xe(this,e,vt,null,l,{dimension:0})}}function Mt(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}function St(e,t,n){const o=e.slice();return o[3]=t[n],o}function Pt(e){let t,n,o,i,r,s,l=e[3].name.substring(0,20)+"",c=e[3].isMaster?"(Master)":"";return{c(){t=M("span"),n=S(l),o=P(),i=S(c),r=P(),s=M("br"),T(t,"text-primary",e[3].isYou)},m(e,l){w(e,t,l),x(t,n),x(t,o),x(t,i),x(t,r),w(e,s,l)},p(e,o){2&o&&l!==(l=e[3].name.substring(0,20)+"")&&C(n,l),2&o&&c!==(c=e[3].isMaster?"(Master)":"")&&C(i,c),2&o&&T(t,"text-primary",e[3].isYou)},d(e){e&&v(t),e&&v(s)}}}function _t(t){let n,o,i;return{c(){n=M("input"),N(n,"class","button primary"),N(n,"type","file")},m(e,r){w(e,n,r),o||(i=F(n,"change",t[2]),o=!0)},p:e,d(e){e&&v(n),o=!1,i()}}}function Ft(t){let n,o,i,r,l,c,a,u,d,f,p,h,m=t[1].name+"",g=t[1].playerNames,$=[];for(let e=0;e<g.length;e+=1)$[e]=Pt(St(t,g,e));let y=t[1].thisPlayer.isMaster&&!t[1].dungeon.init&&_t(t);return{c(){n=M("div"),o=M("div"),i=M("button"),i.innerHTML='<img alt="Copy Game Link" title="Copy Game Link" src="https://icongr.am/feather/copy.svg?size=16"/>',r=P(),l=M("b"),c=S(m),a=P(),u=M("br"),d=P();for(let e=0;e<$.length;e+=1)$[e].c();f=P(),y&&y.c(),N(i,"class","button icon-only"),N(o,"class","card"),N(n,"class","info svelte-cr3cv2")},m(e,m){w(e,n,m),x(n,o),x(o,i),x(o,r),x(o,l),x(l,c),x(l,a),x(o,u),x(o,d);for(let e=0;e<$.length;e+=1)$[e].m(o,null);x(n,f),y&&y.m(n,null),p||(h=F(i,"click",(function(){s(Mt("https://phoenixofforce.github.io/?gid="+t[1].id))&&Mt("https://phoenixofforce.github.io/?gid="+t[1].id).apply(this,arguments)})),p=!0)},p(e,[i]){if(t=e,2&i&&m!==(m=t[1].name+"")&&C(c,m),2&i){let e;for(g=t[1].playerNames,e=0;e<g.length;e+=1){const n=St(t,g,e);$[e]?$[e].p(n,i):($[e]=Pt(n),$[e].c(),$[e].m(o,null))}for(;e<$.length;e+=1)$[e].d(1);$.length=g.length}t[1].thisPlayer.isMaster&&!t[1].dungeon.init?y?y.p(t,i):(y=_t(t),y.c(),y.m(n,null)):y&&(y.d(1),y=null)},i:e,o:e,d(e){e&&v(n),k($,e),y&&y.d(),p=!1,h()}}}function Nt(e,t,n){let o,i;return u(e,Fe,(e=>n(1,o=e))),e.$$.update=()=>{if(1&e.$$.dirty&&i&&i[0]){!function(e){let t=new FileReader(e);t.onload=function(e){let n=JSON.parse(t.result),o=0,i=0;for(let e in n.rects){let t=n.rects[e];t.x<o&&(o=t.x),t.y<i&&(i=t.y)}o-=1,i-=1;for(let e in n.rects){let t=n.rects[e];t.x-=o,t.y-=i,t.visible=!1}for(let e in n.doors){let t=n.doors[e];t.x-=o,t.y-=i}n.init=!0,Fe.update((e=>(e.dungeon=n,e.dungeon.figures=[],e)))},t.readAsText(e)}(i[0])}},[i,o,function(){i=this.files,n(0,i)}]}class Ct extends we{constructor(e){super(),xe(this,e,Nt,Ft,l,{})}}const Et={};function Rt(e){let t,n,o,i,r,s;const l=e[5].default,c=d(l,e,e[4],null);return{c(){t=P(),n=M("div"),c&&c.c(),R(n,"top",e[1]+"px"),R(n,"left",e[0]+"px"),N(n,"class","svelte-1rogqys")},m(o,l){w(o,t,l),w(o,n,l),c&&c.m(n,null),e[6](n),i=!0,r||(s=F(document.body,"click",e[3]),r=!0)},p(e,[t]){c&&c.p&&16&t&&p(c,l,e,e[4],t,null,null),(!i||2&t)&&R(n,"top",e[1]+"px"),(!i||1&t)&&R(n,"left",e[0]+"px")},i(e){i||(ue(c,e),V((()=>{o||(o=pe(n,ke,{duration:100},!0)),o.run(1)})),i=!0)},o(e){de(c,e),o||(o=pe(n,ke,{duration:100},!1)),o.run(0),i=!1},d(i){i&&v(t),i&&v(n),c&&c.d(i),e[6](null),i&&o&&o.end(),r=!1,s()}}}function Tt(e,t,n){let{$$slots:o={},$$scope:i}=t,{x:r}=t,{y:s}=t;const l=j();let c;return H(Et,{dispatchClick:()=>l("click")}),e.$$set=e=>{"x"in e&&n(0,r=e.x),"y"in e&&n(1,s=e.y),"$$scope"in e&&n(4,i=e.$$scope)},e.$$.update=()=>{7&e.$$.dirty&&(()=>{if(!c)return;const e=c.getBoundingClientRect();n(0,r=Math.min(window.innerWidth-e.width,r)),s>window.innerHeight-e.height&&n(1,s-=e.height)})()},[r,s,c,function(e){e.target===c||c.contains(e.target)||l("clickoutside")},i,o,function(e){W[e?"unshift":"push"]((()=>{c=e,n(2,c)}))}]}class Yt extends we{constructor(e){super(),xe(this,e,Tt,Rt,l,{x:0,y:1})}}function Ot(e){let t;const n=e[4].default,o=d(n,e,e[3],null);return{c(){o&&o.c()},m(e,n){o&&o.m(e,n),t=!0},p(e,t){o&&o.p&&8&t&&p(o,n,e,e[3],t,null,null)},i(e){t||(ue(o,e),t=!0)},o(e){de(o,e),t=!1},d(e){o&&o.d(e)}}}function Xt(t){let n;return{c(){n=S(t[1])},m(e,t){w(e,n,t)},p(e,t){2&t&&C(n,e[1])},i:e,o:e,d(e){e&&v(n)}}}function Dt(e){let t,n,o,i,r,s;const l=[Xt,Ot],c=[];function a(e,t){return e[1]?0:1}return n=a(e),o=c[n]=l[n](e),{c(){t=M("div"),o.c(),N(t,"class","svelte-11hdt5k"),T(t,"disabled",e[0])},m(o,l){w(o,t,l),c[n].m(t,null),i=!0,r||(s=F(t,"click",e[2]),r=!0)},p(e,[i]){let r=n;n=a(e),n===r?c[n].p(e,i):(ce(),de(c[r],1,1,(()=>{c[r]=null})),ae(),o=c[n],o?o.p(e,i):(o=c[n]=l[n](e),o.c()),ue(o,1),o.m(t,null)),1&i&&T(t,"disabled",e[0])},i(e){i||(ue(o),i=!0)},o(e){de(o),i=!1},d(e){e&&v(t),c[n].d(),r=!1,s()}}}function zt(e,t,n){let{$$slots:o={},$$scope:i}=t,{isDisabled:r=!1}=t,{text:s=""}=t;const l=j(),{dispatchClick:c}=I(Et);return e.$$set=e=>{"isDisabled"in e&&n(0,r=e.isDisabled),"text"in e&&n(1,s=e.text),"$$scope"in e&&n(3,i=e.$$scope)},[r,s,e=>{r||(l("click"),c())},i,o]}class At extends we{constructor(e){super(),xe(this,e,zt,Dt,l,{isDisabled:0,text:1})}}function Lt(e,t,n){const o=e.slice();return o[11]=t[n],o}function Jt(e){let t,n,o,i,s,l,c,a,u,d,f,p,h,m,g,$,y,b,S,_,C,T,Y,O,X,D,z,A,L=[...e[3].lastFigureColors].reverse(),J=[];for(let t=0;t<L.length;t+=1)J[t]=qt(Lt(e,L,t));return{c(){t=M("div"),n=M("div"),o=M("div"),i=M("div"),s=M("div"),s.innerHTML="<b>Enter Figure Details</b>",l=P(),c=M("div"),a=M("input"),u=P(),d=M("div"),f=M("input"),p=P(),h=M("span"),h.textContent="Select figures Color",m=P(),g=M("div");for(let e=0;e<J.length;e+=1)J[e].c();$=P(),y=M("div"),b=M("div"),S=P(),_=M("div"),C=M("button"),C.textContent="Cancel",T=P(),Y=M("div"),O=M("button"),O.textContent="Add",N(s,"class","title svelte-um3aqw"),N(a,"placeholder","Enter the figures Name"),N(a,"class","is-rounded"),N(f,"type","color"),R(f,"height","50px"),N(h,"class","svelte-um3aqw"),N(d,"class","flex svelte-um3aqw"),N(g,"class","lastUsed svelte-um3aqw"),N(b,"class","col"),N(C,"class","button is-full-width"),N(_,"class","col-2"),N(O,"class","button primary is-full-width"),N(Y,"class","col-2"),N(y,"class","row"),N(i,"class","content svelte-um3aqw"),N(o,"class","modal-container svelte-um3aqw"),N(n,"class","modal-overlay svelte-um3aqw"),N(n,"data-close","")},m(r,v){w(r,t,v),x(t,n),x(n,o),x(o,i),x(i,s),x(i,l),x(i,c),x(c,a),E(a,e[1]),x(i,u),x(i,d),x(d,f),E(f,e[2]),x(d,p),x(d,h),x(i,m),x(i,g);for(let e=0;e<J.length;e+=1)J[e].m(g,null);x(i,$),x(i,y),x(y,b),x(y,S),x(y,_),x(_,C),x(y,T),x(y,Y),x(Y,O),D=!0,z||(A=[F(a,"input",e[8]),F(f,"input",e[9]),F(C,"click",e[7]),F(O,"click",e[5]),F(n,"click",e[4])],z=!0)},p(e,t){if(2&t&&a.value!==e[1]&&E(a,e[1]),4&t&&E(f,e[2]),72&t){let n;for(L=[...e[3].lastFigureColors].reverse(),n=0;n<L.length;n+=1){const o=Lt(e,L,n);J[n]?J[n].p(o,t):(J[n]=qt(o),J[n].c(),J[n].m(g,null))}for(;n<J.length;n+=1)J[n].d(1);J.length=L.length}},i(e){D||(V((()=>{X||(X=pe(n,ke,{duration:150},!0)),X.run(1)})),D=!0)},o(e){X||(X=pe(n,ke,{duration:150},!1)),X.run(0),D=!1},d(e){e&&v(t),k(J,e),e&&X&&X.end(),z=!1,r(A)}}}function qt(e){let t,n,o,i;return{c(){t=M("button"),N(t,"class","button outline"),N(t,"style",n="background-color: "+e[11])},m(n,r){w(n,t,r),o||(i=F(t,"click",(function(){s(e[6](e[11]))&&e[6](e[11]).apply(this,arguments)})),o=!0)},p(o,i){e=o,8&i&&n!==(n="background-color: "+e[11])&&N(t,"style",n)},d(e){e&&v(t),o=!1,i()}}}function jt(e){let t,n,o=e[0]&&Jt(e);return{c(){o&&o.c(),t=_()},m(e,i){o&&o.m(e,i),w(e,t,i),n=!0},p(e,[n]){e[0]?o?(o.p(e,n),1&n&&ue(o,1)):(o=Jt(e),o.c(),ue(o,1),o.m(t.parentNode,t)):o&&(ce(),de(o,1,1,(()=>{o=null})),ae())},i(e){n||(ue(o),n=!0)},o(e){de(o),n=!1},d(e){o&&o.d(e),e&&v(t)}}}function Ht(e,t,n){let o;u(e,Ve,(e=>n(3,o=e)));let i="",r="#ff3e00";const s=j();let{show:l=!1}=t;return e.$$set=e=>{"show"in e&&n(0,l=e.show)},[l,i,r,o,function(e){"close"in e.target.dataset&&n(0,l=!1)},function(){for(o.lastFigureColors.includes(r)||o.lastFigureColors.push(r);o.lastFigureColors.length>11;)o.lastFigureColors.shift();s("accept",{name:i,color:r}),n(0,l=!1)},function(e){n(2,r=e)},function(){n(0,l=!1)},function(){i=this.value,n(1,i)},function(){r=this.value,n(2,r)}]}class It extends we{constructor(e){super(),xe(this,e,Ht,jt,l,{show:0})}}function Gt(e){let t,o;const i=[e[0]];let r={$$slots:{default:[Ut]},$$scope:{ctx:e}};for(let e=0;e<i.length;e+=1)r=n(r,i[e]);return t=new Yt({props:r}),t.$on("click",e[6]),t.$on("clickoutside",e[6]),{c(){ge(t.$$.fragment)},m(e,n){$e(t,e,n),o=!0},p(e,n){const o=1&n?function(e,t){const n={},o={},i={$$scope:1};let r=e.length;for(;r--;){const s=e[r],l=t[r];if(l){for(const e in s)e in l||(o[e]=1);for(const e in l)i[e]||(n[e]=l[e],i[e]=1);e[r]=l}else for(const e in s)i[e]=1}for(const e in o)e in n||(n[e]=void 0);return n}(i,[(r=e[0],"object"==typeof r&&null!==r?r:{})]):{};var r;16402&n&&(o.$$scope={dirty:n,ctx:e}),t.$set(o)},i(e){o||(ue(t.$$.fragment,e),o=!0)},o(e){de(t.$$.fragment,e),o=!1},d(e){ye(t,e)}}}function Wt(t){let n,o;return n=new At({props:{text:"Add Figure"}}),n.$on("click",t[7]),{c(){ge(n.$$.fragment)},m(e,t){$e(n,e,t),o=!0},p:e,i(e){o||(ue(n.$$.fragment,e),o=!0)},o(e){de(n.$$.fragment,e),o=!1},d(e){ye(n,e)}}}function Bt(e){let t,n;return t=new At({props:{text:"Delete "+e[1]}}),t.$on("click",e[9]),{c(){ge(t.$$.fragment)},m(e,o){$e(t,e,o),n=!0},p(e,n){const o={};2&n&&(o.text="Delete "+e[1]),t.$set(o)},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Ut(e){let t,n,o,i,r;const s=[Bt,Wt],l=[];function c(e,t){return e[1].length>0&&e[4].thisPlayer.isMaster?0:e[4].thisPlayer.isMaster?1:-1}return~(t=c(e))&&(n=l[t]=s[t](e)),i=new At({props:{text:"Reset Camera"}}),i.$on("click",e[10]),{c(){n&&n.c(),o=P(),ge(i.$$.fragment)},m(e,n){~t&&l[t].m(e,n),w(e,o,n),$e(i,e,n),r=!0},p(e,i){let r=t;t=c(e),t===r?~t&&l[t].p(e,i):(n&&(ce(),de(l[r],1,1,(()=>{l[r]=null})),ae()),~t?(n=l[t],n?n.p(e,i):(n=l[t]=s[t](e),n.c()),ue(n,1),n.m(o.parentNode,o)):n=null)},i(e){r||(ue(n),ue(i.$$.fragment,e),r=!0)},o(e){de(n),de(i.$$.fragment,e),r=!1},d(e){~t&&l[t].d(e),e&&v(o),ye(i,e)}}}function Qt(e){let t,n,o,i,r,s,l,c=e[2]&&Gt(e);function a(t){e[11].call(null,t)}let u={};return void 0!==e[3]&&(u.show=e[3]),n=new It({props:u}),W.push((()=>me(n,"show",a))),n.$on("accept",e[8]),{c(){c&&c.c(),t=P(),ge(n.$$.fragment),i=P()},m(o,a){var u;c&&c.m(o,a),w(o,t,a),$e(n,o,a),w(o,i,a),r=!0,s||(l=F(document.body,"contextmenu",(u=e[5],function(e){return e.preventDefault(),u.call(this,e)})),s=!0)},p(e,[i]){e[2]?c?(c.p(e,i),4&i&&ue(c,1)):(c=Gt(e),c.c(),ue(c,1),c.m(t.parentNode,t)):c&&(ce(),de(c,1,1,(()=>{c=null})),ae());const r={};!o&&8&i&&(o=!0,r.show=e[3],Z((()=>o=!1))),n.$set(r)},i(e){r||(ue(c),ue(n.$$.fragment,e),r=!0)},o(e){de(c),de(n.$$.fragment,e),r=!1},d(e){c&&c.d(e),e&&v(t),ye(n,e),e&&v(i),s=!1,l()}}}function Kt(e,t,n){let o,i,r;u(e,je,(e=>n(12,o=e))),u(e,Fe,(e=>n(4,i=e))),u(e,Ue,(e=>n(13,r=e)));let s={x:0,y:0},l="",c=!1,a=!1;return[s,l,c,a,i,async function(e){c&&(n(2,c=!1),await new Promise((e=>setTimeout(e,100))));let t=Math.round(2*o.tileX)/2-.5,r=Math.round(2*o.tileY)/2-.5;n(0,s={x:o.screenX,y:o.screenY,tileX:t,tileY:r});let a=i.dungeon.figures.find((e=>e.x===t&&e.y===r));n(1,l=a?a.name?a.name:"Unnamed figure":""),n(2,c=!0)},function(){n(2,c=!1)},function(){n(3,a=!0)},function(e){let t=e.detail;!function(e,t,n){let o={action:"addFigure",pid:n,gid:t,figure:e},i=JSON.stringify(o);Te&&Te.send(i)}({x:s.tileX,y:s.tileY,name:t.name,color:t.color},i.id,i.thisPlayer.id)},function(){!function(e,t,n){let o={action:"removeFigure",pid:n,gid:t,figure:e},i=JSON.stringify(o);Te&&Te.send(i)}({x:s.tileX,y:s.tileY},i.id,i.thisPlayer.id)},function(){h(Ue,r.dx=0,r),h(Ue,r.dy=0,r)},function(e){a=e,n(3,a)}]}class Vt extends we{constructor(e){super(),xe(this,e,Kt,Qt,l,{})}}function Zt(e,t,n){let o,i;return u(e,je,(e=>n(0,o=e))),u(e,Ke,(e=>n(1,i=e))),tt({render:(e,t)=>{const{context:n,width:r,height:s}=e;if(n.save(),o.pick){let e=Math.round(2*o.tileX-1)*i/2,t=Math.round(2*o.tileY-1)*i/2,r=i-8,s=i-8;n.beginPath(),n.fillStyle=o.pick.color+"AA",n.ellipse(e+i/2,t+i/2,r/2,s/2,0,0,2*Math.PI),n.closePath(),n.fill(),n.beginPath()}n.restore()},height:8}),[]}class en extends we{constructor(e){super(),xe(this,e,Zt,null,l,{})}}function tn(e,t,n){const o=e.slice();return o[8]=t[n],o}function nn(e,t,n){const o=e.slice();return o[11]=t[n],o[12]=t,o[13]=n,o}function on(e,t,n){const o=e.slice();return o[11]=t[n],o}function rn(e){let t,n,o,i,r,s,l;return n=new rt({props:{$$slots:{default:[un]},$$scope:{ctx:e}}}),n.$on("click",e[2]),n.$on("down",e[4]),i=new Vt({}),{c(){t=M("div"),ge(n.$$.fragment),o=P(),ge(i.$$.fragment),N(t,"id","canvasDisplay"),N(t,"class","svelte-qo5sc3")},m(c,a){w(c,t,a),$e(n,t,null),x(t,o),$e(i,t,null),r=!0,s||(l=F(t,"mousemove",e[3]),s=!0)},p(e,t){const o={};65539&t&&(o.$$scope={dirty:t,ctx:e}),n.$set(o)},i(e){r||(ue(n.$$.fragment,e),ue(i.$$.fragment,e),r=!0)},o(e){de(n.$$.fragment,e),de(i.$$.fragment,e),r=!1},d(e){e&&v(t),ye(n),ye(i),s=!1,l()}}}function sn(e){let t,n;return t=new pt({props:{dimension:e[11]}}),{c(){ge(t.$$.fragment)},m(e,o){$e(t,e,o),n=!0},p(e,n){const o={};2&n&&(o.dimension=e[11]),t.$set(o)},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function ln(e){let t,n,o;function i(t){e[5].call(null,t,e[11],e[12],e[13])}let r={};return void 0!==e[11]&&(r.dimension=e[11]),t=new kt({props:r}),W.push((()=>me(t,"dimension",i))),{c(){ge(t.$$.fragment)},m(e,n){$e(t,e,n),o=!0},p(o,i){e=o;const r={};!n&&2&i&&(n=!0,r.dimension=e[11],Z((()=>n=!1))),t.$set(r)},i(e){o||(ue(t.$$.fragment,e),o=!0)},o(e){de(t.$$.fragment,e),o=!1},d(e){ye(t,e)}}}function cn(e){let t,n,o;function i(t){e[6].call(null,t)}let r={};return void 0!==e[0]&&(r.dimension=e[0]),t=new wt({props:r}),W.push((()=>me(t,"dimension",i))),{c(){ge(t.$$.fragment)},m(e,n){$e(t,e,n),o=!0},p(e,o){const i={};!n&&1&o&&(n=!0,i.dimension=e[0],Z((()=>n=!1))),t.$set(i)},i(e){o||(ue(t.$$.fragment,e),o=!0)},o(e){de(t.$$.fragment,e),o=!1},d(e){ye(t,e)}}}function an(e){let t,n;return t=new bt({props:{pos:e[8]}}),{c(){ge(t.$$.fragment)},m(e,o){$e(t,e,o),n=!0},p(e,n){const o={};2&n&&(o.pos=e[8]),t.$set(o)},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function un(e){let t,n,o,i,r,s,l,c,a,u;t=new dt({});let d=e[1].dungeon.rects,f=[];for(let t=0;t<d.length;t+=1)f[t]=sn(on(e,d,t));const p=e=>de(f[e],1,1,(()=>{f[e]=null}));let h=e[1].dungeon.doors,m=[];for(let t=0;t<h.length;t+=1)m[t]=ln(nn(e,h,t));const g=e=>de(m[e],1,1,(()=>{m[e]=null}));r=new ct({});let $=e[1].thisPlayer.isMaster&&cn(e),y=e[1].dungeon.figures,b=[];for(let t=0;t<y.length;t+=1)b[t]=an(tn(e,y,t));const x=e=>de(b[e],1,1,(()=>{b[e]=null}));return a=new en({}),{c(){ge(t.$$.fragment),n=P();for(let e=0;e<f.length;e+=1)f[e].c();o=P();for(let e=0;e<m.length;e+=1)m[e].c();i=P(),ge(r.$$.fragment),s=P(),$&&$.c(),l=P();for(let e=0;e<b.length;e+=1)b[e].c();c=P(),ge(a.$$.fragment)},m(e,d){$e(t,e,d),w(e,n,d);for(let t=0;t<f.length;t+=1)f[t].m(e,d);w(e,o,d);for(let t=0;t<m.length;t+=1)m[t].m(e,d);w(e,i,d),$e(r,e,d),w(e,s,d),$&&$.m(e,d),w(e,l,d);for(let t=0;t<b.length;t+=1)b[t].m(e,d);w(e,c,d),$e(a,e,d),u=!0},p(e,n){const r={};if(65536&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r),2&n){let t;for(d=e[1].dungeon.rects,t=0;t<d.length;t+=1){const i=on(e,d,t);f[t]?(f[t].p(i,n),ue(f[t],1)):(f[t]=sn(i),f[t].c(),ue(f[t],1),f[t].m(o.parentNode,o))}for(ce(),t=d.length;t<f.length;t+=1)p(t);ae()}if(2&n){let t;for(h=e[1].dungeon.doors,t=0;t<h.length;t+=1){const o=nn(e,h,t);m[t]?(m[t].p(o,n),ue(m[t],1)):(m[t]=ln(o),m[t].c(),ue(m[t],1),m[t].m(i.parentNode,i))}for(ce(),t=h.length;t<m.length;t+=1)g(t);ae()}if(e[1].thisPlayer.isMaster?$?($.p(e,n),2&n&&ue($,1)):($=cn(e),$.c(),ue($,1),$.m(l.parentNode,l)):$&&(ce(),de($,1,1,(()=>{$=null})),ae()),2&n){let t;for(y=e[1].dungeon.figures,t=0;t<y.length;t+=1){const o=tn(e,y,t);b[t]?(b[t].p(o,n),ue(b[t],1)):(b[t]=an(o),b[t].c(),ue(b[t],1),b[t].m(c.parentNode,c))}for(ce(),t=y.length;t<b.length;t+=1)x(t);ae()}},i(e){if(!u){ue(t.$$.fragment,e);for(let e=0;e<d.length;e+=1)ue(f[e]);for(let e=0;e<h.length;e+=1)ue(m[e]);ue(r.$$.fragment,e),ue($);for(let e=0;e<y.length;e+=1)ue(b[e]);ue(a.$$.fragment,e),u=!0}},o(e){de(t.$$.fragment,e),f=f.filter(Boolean);for(let e=0;e<f.length;e+=1)de(f[e]);m=m.filter(Boolean);for(let e=0;e<m.length;e+=1)de(m[e]);de(r.$$.fragment,e),de($),b=b.filter(Boolean);for(let e=0;e<b.length;e+=1)de(b[e]);de(a.$$.fragment,e),u=!1},d(e){ye(t,e),e&&v(n),k(f,e),e&&v(o),k(m,e),e&&v(i),ye(r,e),e&&v(s),$&&$.d(e),e&&v(l),k(b,e),e&&v(c),ye(a,e)}}}function dn(e){let t,n,o,i;t=new Ct({});let r=e[1].dungeon.init&&rn(e);return{c(){ge(t.$$.fragment),n=P(),r&&r.c(),o=_()},m(e,s){$e(t,e,s),w(e,n,s),r&&r.m(e,s),w(e,o,s),i=!0},p(e,[t]){e[1].dungeon.init?r?(r.p(e,t),2&t&&ue(r,1)):(r=rn(e),r.c(),ue(r,1),r.m(o.parentNode,o)):r&&(ce(),de(r,1,1,(()=>{r=null})),ae())},i(e){i||(ue(t.$$.fragment,e),ue(r),i=!0)},o(e){de(t.$$.fragment,e),de(r),i=!1},d(e){ye(t,e),e&&v(n),r&&r.d(e),e&&v(o)}}}function fn(e,t,n){let o,i;u(e,Fe,(e=>n(1,o=e))),u(e,je,(e=>n(7,i=e)));let r={x:0,y:0,w:1,h:1};return[r,o,function(e){let t=e.detail,n=o.dungeon.rects.find((e=>t.tileX>=e.x&&t.tileX<e.x+e.w&&t.tileY>=e.y&&t.tileY<=e.y+e.h)),i=o.dungeon.doors.find((e=>Math.floor(t.tileX)==e.x&&Math.floor(t.tileY)==e.y));n&&(n.visible?(function(e,t,n){let o={action:"hideRoom",room:e,pid:n,gid:t},i=JSON.stringify(o);Te&&Te.send(i)}(n,o.id,o.thisPlayer.id),i&&function(e,t,n){let o={action:"hideDoor",door:e,pid:n,gid:t},i=JSON.stringify(o);Te&&Te.send(i)}(i,o.id,o.thisPlayer.id)):(function(e,t,n){let o={action:"showRoom",room:e,pid:n,gid:t},i=JSON.stringify(o);Te&&Te.send(i)}(n,o.id,o.thisPlayer.id),i&&function(e,t,n){let o={action:"showDoor",door:e,pid:n,gid:t},i=JSON.stringify(o);Te&&Te.send(i)}(i,o.id,o.thisPlayer.id)))},function(e){let t=i.tileX,s=i.tileY;n(0,r=o.dungeon.rects.find((e=>t>=e.x&&t<e.x+e.w&&s>=e.y&&s<=e.y+e.h)))},function(e){let t=Math.round(2*i.tileX)/2-.5,n=Math.round(2*i.tileY)/2-.5,r=o.dungeon.figures.find((e=>e.x===t&&e.y===n));h(je,i.pick=r,i)},function(e,t,n,i){n[i]=e,Fe.set(o)},function(e){r=e,n(0,r)}]}class pn extends we{constructor(e){super(),xe(this,e,fn,dn,l,{})}}function hn(e){let t,n,o,i,r,s,l,c,a,u=e[0].message+"";return{c(){t=M("div"),n=M("span"),o=S(u),i=P(),r=M("button"),r.innerHTML='<img alt="Close Error" title="Close Error" src="https://icongr.am/feather/x.svg?size=16&amp;color=FFFFFF"/>',N(n,"class",""),N(r,"class","button clear icon-only"),N(t,"class","bg-error text-white flex-container svelte-t4cg3o")},m(e,s){w(e,t,s),x(t,n),x(n,o),x(t,i),x(t,r),l=!0,c||(a=F(r,"click",Ee),c=!0)},p(e,t){(!l||1&t)&&u!==(u=e[0].message+"")&&C(o,u)},i(e){l||(V((()=>{s||(s=pe(t,Me,{y:-100,opacity:1},!0)),s.run(1)})),l=!0)},o(e){s||(s=pe(t,Me,{y:-100,opacity:1},!1)),s.run(0),l=!1},d(e){e&&v(t),e&&s&&s.end(),c=!1,a()}}}function mn(e){let t,n,o=e[0].message&&hn(e);return{c(){o&&o.c(),t=_()},m(e,i){o&&o.m(e,i),w(e,t,i),n=!0},p(e,[n]){e[0].message?o?(o.p(e,n),1&n&&ue(o,1)):(o=hn(e),o.c(),ue(o,1),o.m(t.parentNode,t)):o&&(ce(),de(o,1,1,(()=>{o=null})),ae())},i(e){n||(ue(o),n=!0)},o(e){de(o),n=!1},d(e){o&&o.d(e),e&&v(t)}}}function gn(e,t,n){let o;return u(e,Ne,(e=>n(0,o=e))),[o]}class $n extends we{constructor(e){super(),xe(this,e,gn,mn,l,{})}}function yn(e){let t,n;return t=new pn({}),{c(){ge(t.$$.fragment)},m(e,o){$e(t,e,o),n=!0},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function bn(e){let t,n;return t=new qe({}),{c(){ge(t.$$.fragment)},m(e,o){$e(t,e,o),n=!0},i(e){n||(ue(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function xn(e){let t,n,o,i,r,s;t=new $n({});const l=[bn,yn],c=[];function a(e,t){return-1==e[0].id?0:1}return o=a(e),i=c[o]=l[o](e),{c(){ge(t.$$.fragment),n=P(),i.c(),r=_()},m(e,i){$e(t,e,i),w(e,n,i),c[o].m(e,i),w(e,r,i),s=!0},p(e,[t]){let n=o;o=a(e),o!==n&&(ce(),de(c[n],1,1,(()=>{c[n]=null})),ae(),i=c[o],i?i.p(e,t):(i=c[o]=l[o](e),i.c()),ue(i,1),i.m(r.parentNode,r))},i(e){s||(ue(t.$$.fragment,e),ue(i),s=!0)},o(e){de(t.$$.fragment,e),de(i),s=!1},d(e){ye(t,e),e&&v(n),c[o].d(e),e&&v(r)}}}function wn(e,t,n){let o;var i;return u(e,Fe,(e=>n(0,o=e))),i=()=>{!function(e,t){let n={action:"playerLeave",pid:t,gid:e},o=JSON.stringify(n);Te&&Te.send(o)}(o.id,o.thisPlayer.id)},J().$$.on_destroy.push(i),[o]}return new class extends we{constructor(e){super(),xe(this,e,wn,xn,l,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
