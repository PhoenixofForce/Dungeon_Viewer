var app=function(){"use strict";function t(){}const e=t=>t;function n(t){return t()}function o(){return Object.create(null)}function i(t){t.forEach(n)}function r(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function c(t){let e;return l(t,(t=>e=t))(),e}function u(t,e,n){t.$$.on_destroy.push(l(e,n))}function a(t,e,n,o){if(t){const i=d(t,e,n,o);return t[0](i)}}function d(t,e,n,o){return t[1]&&o?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](o(e))):n.ctx}function f(t,e,n,o,i,r,s){const l=function(t,e,n,o){if(t[2]&&o){const i=t[2](o(n));if(void 0===e.dirty)return i;if("object"==typeof i){const t=[],n=Math.max(e.dirty.length,i.length);for(let o=0;o<n;o+=1)t[o]=e.dirty[o]|i[o];return t}return e.dirty|i}return e.dirty}(e,o,i,r);if(l){const i=d(e,n,o,s);t.p(i,l)}}function h(t,e,n=e){return t.set(n),e}const m="undefined"!=typeof window;let p=m?()=>window.performance.now():()=>Date.now(),g=m?t=>requestAnimationFrame(t):t;const y=new Set;function $(t){y.forEach((e=>{e.c(t)||(y.delete(e),e.f())})),0!==y.size&&g($)}function x(t,e){t.appendChild(e)}function b(t,e,n){t.insertBefore(e,n||null)}function w(t){t.parentNode.removeChild(t)}function v(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function k(t){return document.createElement(t)}function _(t){return document.createTextNode(t)}function M(){return _(" ")}function E(){return _("")}function N(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function P(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function S(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function O(t,e){t.value=null==e?"":e}function R(t,e,n,o){t.style.setProperty(e,n,o?"important":"")}function F(t,e,n){t.classList[n?"add":"remove"](e)}function C(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}const T=new Set;let J,L=0;function A(t,e,n,o,i,r,s,l=0){const c=16.666/o;let u="{\n";for(let t=0;t<=1;t+=c){const o=e+(n-e)*r(t);u+=100*t+`%{${s(o,1-o)}}\n`}const a=u+`100% {${s(n,1-n)}}\n}`,d=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(a)}_${l}`,f=t.ownerDocument;T.add(f);const h=f.__svelte_stylesheet||(f.__svelte_stylesheet=f.head.appendChild(k("style")).sheet),m=f.__svelte_rules||(f.__svelte_rules={});m[d]||(m[d]=!0,h.insertRule(`@keyframes ${d} ${a}`,h.cssRules.length));const p=t.style.animation||"";return t.style.animation=`${p?`${p}, `:""}${d} ${o}ms linear ${i}ms 1 both`,L+=1,d}function Y(t,e){const n=(t.style.animation||"").split(", "),o=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),i=n.length-o.length;i&&(t.style.animation=o.join(", "),L-=i,L||g((()=>{L||(T.forEach((t=>{const e=t.__svelte_stylesheet;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.__svelte_rules={}})),T.clear())})))}function D(t){J=t}function j(){if(!J)throw new Error("Function called outside component initialization");return J}function I(t){j().$$.on_mount.push(t)}const X=[],G=[],z=[],H=[],q=Promise.resolve();let W=!1;function B(t){z.push(t)}function K(t){H.push(t)}let Q=!1;const U=new Set;function V(){if(!Q){Q=!0;do{for(let t=0;t<X.length;t+=1){const e=X[t];D(e),Z(e.$$)}for(D(null),X.length=0;G.length;)G.pop()();for(let t=0;t<z.length;t+=1){const e=z[t];U.has(e)||(U.add(e),e())}z.length=0}while(X.length);for(;H.length;)H.pop()();W=!1,Q=!1,U.clear()}}function Z(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(B)}}let tt;function et(t,e,n){t.dispatchEvent(C(`${e?"intro":"outro"}${n}`))}const nt=new Set;let ot;function it(){ot={r:0,c:[],p:ot}}function rt(){ot.r||i(ot.c),ot=ot.p}function st(t,e){t&&t.i&&(nt.delete(t),t.i(e))}function lt(t,e,n,o){if(t&&t.o){if(nt.has(t))return;nt.add(t),ot.c.push((()=>{nt.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}const ct={duration:0};function ut(n,o,s,l){let c=o(n,s),u=l?0:1,a=null,d=null,f=null;function h(){f&&Y(n,f)}function m(t,e){const n=t.b-u;return e*=Math.abs(n),{a:u,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function x(o){const{delay:r=0,duration:s=300,easing:l=e,tick:x=t,css:b}=c||ct,w={start:p()+r,b:o};o||(w.group=ot,ot.r+=1),a||d?d=w:(b&&(h(),f=A(n,u,o,s,r,l,b)),o&&x(0,1),a=m(w,s),B((()=>et(n,o,"start"))),function(t){let e;0===y.size&&g($),new Promise((n=>{y.add(e={c:t,f:n})}))}((t=>{if(d&&t>d.start&&(a=m(d,s),d=null,et(n,a.b,"start"),b&&(h(),f=A(n,u,a.b,a.duration,0,l,c.css))),a)if(t>=a.end)x(u=a.b,1-u),et(n,a.b,"end"),d||(a.b?h():--a.group.r||i(a.group.c)),a=null;else if(t>=a.start){const e=t-a.start;u=a.a+a.d*l(e/a.duration),x(u,1-u)}return!(!a&&!d)})))}return{run(t){r(c)?(tt||(tt=Promise.resolve(),tt.then((()=>{tt=null}))),tt).then((()=>{c=c(),x(t)})):x(t)},end(){h(),a=d=null}}}const at="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function dt(t,e,n){const o=t.$$.props[e];void 0!==o&&(t.$$.bound[o]=n,n(t.$$.ctx[o]))}function ft(t){t&&t.c()}function ht(t,e,o){const{fragment:s,on_mount:l,on_destroy:c,after_update:u}=t.$$;s&&s.m(e,o),B((()=>{const e=l.map(n).filter(r);c?c.push(...e):i(e),t.$$.on_mount=[]})),u.forEach(B)}function mt(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function pt(t,e){-1===t.$$.dirty[0]&&(X.push(t),W||(W=!0,q.then(V)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function gt(e,n,r,s,l,c,u=[-1]){const a=J;D(e);const d=n.props||{},f=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:l,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:o(),dirty:u,skip_bound:!1};let h=!1;if(f.ctx=r?r(e,d,((t,n,...o)=>{const i=o.length?o[0]:n;return f.ctx&&l(f.ctx[t],f.ctx[t]=i)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](i),h&&pt(e,t)),n})):[],f.update(),h=!0,i(f.before_update),f.fragment=!!s&&s(f.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);f.fragment&&f.fragment.l(t),t.forEach(w)}else f.fragment&&f.fragment.c();n.intro&&st(e.$$.fragment),ht(e,n.target,n.anchor),V()}D(a)}class yt{$destroy(){mt(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const $t=[];function xt(e,n=t){let o;const i=[];function r(t){if(s(e,t)&&(e=t,o)){const t=!$t.length;for(let t=0;t<i.length;t+=1){const n=i[t];n[1](),$t.push(n,e)}if(t){for(let t=0;t<$t.length;t+=2)$t[t][0]($t[t+1]);$t.length=0}}}return{set:r,update:function(t){r(t(e))},subscribe:function(s,l=t){const c=[s,l];return i.push(c),1===i.length&&(o=n(r)||t),s(e),()=>{const t=i.indexOf(c);-1!==t&&i.splice(t,1),0===i.length&&(o(),o=null)}}}}function bt(e,n,o){const s=!Array.isArray(e),c=s?[e]:e,u=n.length<2;return{subscribe:xt(o,(e=>{let o=!1;const a=[];let d=0,f=t;const h=()=>{if(d)return;f();const o=n(s?a[0]:a,e);u?e(o):f=r(o)?o:t},m=c.map(((t,e)=>l(t,(t=>{a[e]=t,d&=~(1<<e),o&&h()}),(()=>{d|=1<<e}))));return o=!0,h(),function(){i(m),f()}})).subscribe}}const wt=xt({id:-1});const vt=xt({message:"",timeout:{}});function kt(t){vt.update((e=>(e.message=t,e.timeout&&clearTimeout(e.timeout),t&&(e.timeput=setInterval(_t,5e3)),e)))}function _t(){kt("")}const Mt="vast-cliffs-53607.herokuapp.com";let Et;function Nt(t){return new Promise((function(e,n){let o=new XMLHttpRequest;o.onload=function(){var t=o.status;200==t?e(JSON.parse(o.responseText)):n(t)},o.onerror=function(t){kt("The Server seems to be offline.")},o.open("POST",`https://${Mt}:52832`,!0),o.setRequestHeader("Content-type","application/json"),o.send(t)}))}function Pt(t,e){Et=new WebSocket(`wss://${Mt}/websocket`),Et.onopen=function(){let n={action:"register",pid:e,gid:t};Et.send(JSON.stringify(n))},Et.onmessage=function(t){let e=JSON.parse(t.data);if("ping"!=e.action&&console.log(e),"userJoined"===e.action)r=e.user,wt.update((t=>(t.playerNames.push(r),t)));else if("showRoom"===e.action)i=e.room,wt.update((t=>(t.thisPlayer.isMaster?t.dungeon.rects.find((t=>t.x==i.x&&t.y==i.y&&t.w==i.w&&t.h==i.h)).visible=i.visible:t.dungeon.rects=[...t.dungeon.rects,i],t)));else if("showDoor"===e.action)!function(t){wt.update((e=>(e.thisPlayer.isMaster||(e.dungeon.doors=[...e.dungeon.doors,t]),e)))}(e.door);else if("kick"===e.action)Et&&Et.close(),wt.set({id:-1}),kt("You were kicked: "+e.message);else if("ping"===e.action){let t=c(wt).id,e={action:"pong",pid:c(wt).thisPlayer.id,gid:t};Et.send(JSON.stringify(e))}else"userLeft"===e.action?(o=e.user,wt.update((t=>{let e=t.playerNames.findIndex((t=>t.name===o.name));return e>0&&t.playerNames.splice(e,1),t}))):"hideDoor"===e.action?(n=e.door,wt.update((t=>{if(!t.thisPlayer.isMaster){let e=t.dungeon.doors.findIndex((t=>t.x===n.x&&t.y===n.y));e>=0&&t.dungeon.doors.splice(e,1)}return t}))):"hideRoom"===e.action&&function(t){wt.update((e=>{if(e.thisPlayer.isMaster)e.dungeon.rects.find((e=>e.x==t.x&&e.y==t.y&&e.w==t.w&&e.h==t.h)).visible=t.visible;else{let n=e.dungeon.rects.findIndex((e=>e.x==t.x&&e.y==t.y&&e.w==t.w&&e.h==t.h));n>=0&&e.dungeon.rects.splice(n,1)}return e}))}(e.room);var n,o,i,r}}function St(e){let n,o,r,s,l,c,u,a,d,f,h,m,p,g,y,$;return{c(){n=k("div"),o=k("div"),r=k("div"),s=k("input"),l=M(),c=k("div"),u=k("div"),a=k("input"),d=M(),f=k("div"),h=k("button"),h.textContent="Join Game",m=M(),p=k("div"),g=k("button"),g.textContent="Create Game",P(s,"placeholder","Enter Game Name"),P(s,"class","is-rounded"),P(r,"class","col"),P(o,"class","row"),P(a,"placeholder","Enter your Name"),P(a,"class","is-rounded"),P(u,"class","col"),P(h,"class","button is-full-width"),P(f,"class","col-2"),P(g,"class","button primary is-full-width"),P(p,"class","col-2"),P(c,"class","row"),P(n,"class","main card svelte-7esanw")},m(t,i){b(t,n,i),x(n,o),x(o,r),x(r,s),O(s,e[0]),x(n,l),x(n,c),x(c,u),x(u,a),O(a,e[1]),x(c,d),x(c,f),x(f,h),x(c,m),x(c,p),x(p,g),y||($=[N(s,"input",e[4]),N(a,"input",e[5]),N(h,"click",e[3]),N(g,"click",e[2])],y=!0)},p(t,[e]){1&e&&s.value!==t[0]&&O(s,t[0]),2&e&&a.value!==t[1]&&O(a,t[1])},i:t,o:t,d(t){t&&w(n),y=!1,i($)}}}function Ot(t,e,n){let o;u(t,wt,(t=>n(6,o=t)));let i="",r="";return[i,r,async function(){let t=await function(t,e){let n={action:"createGame",gameName:t,masterName:e};return Nt(JSON.stringify(n))}(i,r);t.isError?kt(t.error):(h(wt,o={id:t.game.id,name:t.game.name,playerNames:[{name:r,isMaster:!0,isYou:!0}],thisPlayer:{id:t.player.id,name:r,isMaster:!0,isYou:!0},dungeon:t.dungeon},o),Pt(o.id,o.thisPlayer.id),_t())},async function(){let t=await function(t,e){let n={action:"joinGame",gameID:t,playerName:e};return Nt(JSON.stringify(n))}(i,r);t.isError?kt(t.error):(h(wt,o={id:t.id,name:t.gameName,playerNames:t.player,thisPlayer:{id:t.playerID,name:r,isMaster:!1,isYou:!0},dungeon:t.dungeon},o),Pt(o.id,o.thisPlayer.id),_t())},function(){i=this.value,n(0,i)},function(){r=this.value,n(1,r)}]}class Rt extends yt{constructor(t){super(),gt(this,t,Ot,St,s,{})}}const Ft=xt(window.innerWidth),Ct=xt(window.innerHeight),Tt=xt(window.devicePixelRatio),Jt=xt(),Lt=xt(),At=xt({dx:0,dy:0}),Yt=xt(0),Dt=xt(32),jt=xt({background:"#0E0E0E",rooms:"#EEEEEE"}),It=function(t){const e=Object.keys(t);return bt(e.map((e=>t[e])),(t=>t.reduce(((t,n,o)=>(t[e[o]]=n,t)),{})))}({context:Jt,canvas:Lt,width:Ft,height:Ct,pixelRatio:Tt,time:Yt}),Xt=Symbol(),Gt=t=>{const e=function(t){return j().$$.context.get(t)}(Xt),n={ready:!1,mounted:!1};"function"==typeof t?(n.render=t,n.height=0):t&&(t.render&&(n.render=t.render),t.setup&&(n.setup=t.setup),t.height&&(n.height=t.height)),e.add(n),I((()=>(n.mounted=!0,()=>{e.remove(n),n.mounted=!1})))};const{window:zt}=at;function Ht(t){let e,n,o,r,s,l,c;const u=t[11].default,d=a(u,t,t[10],null);return{c(){e=k("canvas"),r=M(),d&&d.c(),P(e,"width",n=t[2]*t[1]),P(e,"height",o=t[3]*t[1]),R(e,"width",t[2]+"px"),R(e,"height",t[3]+"px")},m(n,o){b(n,e,o),t[12](e),b(n,r,o),d&&d.m(n,o),s=!0,l||(c=[N(zt,"resize",t[4],{passive:!0}),N(e,"mousemove",t[6]),N(e,"mousedown",t[7]),N(e,"mouseup",t[5])],l=!0)},p(t,[i]){(!s||6&i&&n!==(n=t[2]*t[1]))&&P(e,"width",n),(!s||10&i&&o!==(o=t[3]*t[1]))&&P(e,"height",o),(!s||4&i)&&R(e,"width",t[2]+"px"),(!s||8&i)&&R(e,"height",t[3]+"px"),d&&d.p&&1024&i&&f(d,u,t,t[10],i,null,null)},i(t){s||(st(d,t),s=!0)},o(t){lt(d,t),s=!1},d(n){n&&w(e),t[12](null),n&&w(r),d&&d.d(n),l=!1,i(c)}}}function qt(t,e,n){let o,i,r,s,l,c;u(t,It,(t=>n(19,o=t))),u(t,At,(t=>n(20,i=t))),u(t,Tt,(t=>n(1,r=t))),u(t,Dt,(t=>n(21,s=t))),u(t,Ft,(t=>n(2,l=t))),u(t,Ct,(t=>n(3,c=t)));let a,d,f,m,{$$slots:p={},$$scope:g}=e,{killLoopOnError:y=!0}=e,{attributes:$={}}=e,x=!1,b=0,w=0,v=[];I((()=>(f=d.getContext("2d",$),Lt.set(d),Jt.set(f),function(t){let e=0,n=performance.now();return function o(){m=requestAnimationFrame(o);const i=performance.now(),r=(i-n)/1e3;n=i,e+=r,t(e,r)}(),()=>{cancelAnimationFrame(m)}}(((t,e)=>{Yt.set(t),function(t){f.save(),f.translate(-i.dx,-i.dy),f.scale(r,r),v.forEach((e=>{try{e.mounted&&e.ready&&e.render&&e.render(o,t)}catch(t){console.error(t),y&&(cancelAnimationFrame(m),console.warn("Animation loop stopped due to an error"))}})),f.restore()}(e)}))))),function(t,e){j().$$.context.set(t,e)}(Xt,{add(t){if(this.remove(t),v.push(t),t.setup){let e=t.setup(o);e&&e.then}t.ready=!0,v.sort(((t,e)=>t.height-e.height))},remove(t){const e=v.indexOf(t);e>=0&&v.splice(e,1)}});const k=function(){const t=j();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const i=C(e,n);o.slice().forEach((e=>{e.call(t,i)}))}}}();return t.$$set=t=>{"killLoopOnError"in t&&n(8,y=t.killLoopOnError),"attributes"in t&&n(9,$=t.attributes),"$$scope"in t&&n(10,g=t.$$scope)},[d,r,l,c,function(){Ft.set(window.innerWidth),Ct.set(window.innerHeight),Tt.set(window.devicePixelRatio)},function(t){x=!1;let e=t.x+i.dx/r,n=t.y+i.dy/r;Date.now()-a<200&&k("click",{x:e,y:n,tileX:e/s,tileY:n/s})},function(t){x&&h(At,i={dx:i.dx+(b-t.clientX)*r,dy:i.dy+(w-t.clientY)*r},i),b=t.clientX,w=t.clientY},function(t){x=!0,a=Date.now()},y,$,g,p,function(t){G[t?"unshift":"push"]((()=>{d=t,n(0,d)}))}]}class Wt extends yt{constructor(t){super(),gt(this,t,qt,Ht,s,{killLoopOnError:8,attributes:9})}}function Bt(t){let e;const n=t[2].default,o=a(n,t,t[1],null);return{c(){o&&o.c()},m(t,n){o&&o.m(t,n),e=!0},p(t,[e]){o&&o.p&&2&e&&f(o,n,t,t[1],e,null,null)},i(t){e||(st(o,t),e=!0)},o(t){lt(o,t),e=!1},d(t){o&&o.d(t)}}}function Kt(t,e,n){let o,i,r,s;u(t,jt,(t=>n(3,o=t))),u(t,Tt,(t=>n(4,i=t))),u(t,At,(t=>n(5,r=t))),u(t,Dt,(t=>n(6,s=t)));let{$$slots:l={},$$scope:c}=e,{color:a=o.background+"6"}=e;return Gt({render:t=>{const{context:e,width:n,height:o}=t;e.save();let l=i,c=r.dx/l,u=r.dy/l,d=n,f=o,h=c/s;h=h<0?Math.floor(h):Math.ceil(h);let m=u/s;m=m<0?Math.floor(m):Math.ceil(m);for(let t=Math.min(0,h);t<Math.max(0,h)+d/s;t++)e.beginPath(),e.strokeStyle=a,e.moveTo(t*s,u),e.lineTo(t*s,f+u),e.stroke();for(let t=Math.min(0,m);t<Math.max(0,m)+f/s;t++)e.beginPath(),e.strokeStyle=a,e.moveTo(c,t*s),e.lineTo(c+d,t*s),e.stroke();e.restore()},height:3}),t.$$set=t=>{"color"in t&&n(0,a=t.color),"$$scope"in t&&n(1,c=t.$$scope)},[a,c,l]}class Qt extends yt{constructor(t){super(),gt(this,t,Kt,Bt,s,{color:0})}}function Ut(t){let e;const n=t[1].default,o=a(n,t,t[0],null);return{c(){o&&o.c()},m(t,n){o&&o.m(t,n),e=!0},p(t,[e]){o&&o.p&&1&e&&f(o,n,t,t[0],e,null,null)},i(t){e||(st(o,t),e=!0)},o(t){lt(o,t),e=!1},d(t){o&&o.d(t)}}}function Vt(t,e,n){let o,i,r;u(t,jt,(t=>n(2,o=t))),u(t,Tt,(t=>n(3,i=t))),u(t,At,(t=>n(4,r=t)));let{$$slots:s={},$$scope:l}=e,c=o.background+"F";return Gt((t=>{const{context:e,width:n,height:o}=t;e.save();let s=i;e.clearRect(r.dx/s,r.dy/s,n,o),c&&(e.fillStyle=c,e.fillRect(r.dx/s,r.dy/i,n,o)),e.restore()})),t.$$set=t=>{"$$scope"in t&&n(0,l=t.$$scope)},[l,s]}class Zt extends yt{constructor(t){super(),gt(this,t,Vt,Ut,s,{})}}function te(t,e,n){let o,i;u(t,Dt,(t=>n(1,o=t))),u(t,jt,(t=>n(2,i=t)));let{dimension:r}=e;return Gt({render:(t,e)=>{const{context:n,width:s,height:l}=t;if(n.save(),r){let t=r.x*o,e=r.y*o,s=r.w*o,l=r.h*o;r.rotunda?(n.beginPath(),n.fillStyle=i.rooms,n.ellipse(t+s/2,e+l/2,s/2,l/2,0,0,2*Math.PI),n.closePath(),n.fill(),n.beginPath(),r.visible||(n.fillStyle=r.visible?"#0F06":"#F006",n.ellipse(t+s/2,e+l/2,s/2,l/2,0,0,2*Math.PI),n.closePath(),n.fill())):(n.fillStyle=i.rooms,n.fillRect(t,e,s,l),r.visible||(n.fillStyle=r.visible?"#0F06":"#F006",n.fillRect(t,e,s,l)))}n.restore()},height:1}),t.$$set=t=>{"dimension"in t&&n(0,r=t.dimension)},[r]}class ee extends yt{constructor(t){super(),gt(this,t,te,null,s,{dimension:0})}}function ne(t,e,n){let o;u(t,Dt,(t=>n(2,o=t)));let{color:i="#F8F8F4"}=e,{dimension:r}=e;return Gt({render:(t,e)=>{const{context:n,width:i,height:s}=t;n.save(),r&&(n.strokeStyle="#FF0",n.lineWidth=3,n.strokeRect(r.x*o,r.y*o,r.w*o,r.h*o),n.lineWidth=1),n.restore()},height:4}),t.$$set=t=>{"color"in t&&n(0,i=t.color),"dimension"in t&&n(1,r=t.dimension)},[i,r]}class oe extends yt{constructor(t){super(),gt(this,t,ne,null,s,{color:0,dimension:1})}}function ie(t,e,n){let o,i;u(t,jt,(t=>n(1,o=t))),u(t,Dt,(t=>n(2,i=t)));let{dimension:r}=e;function s(t){t.fillStyle=o.background;let e=r.x*i,n=r.y*i,s=i,l=i;1==Math.abs(r.dir.y)?(l/=2,n+=l/2,s=i/8):(s/=2,e+=s/2,l=i/8),t.fillRect(e,n,s,l),1==Math.abs(r.dir.y)?e+=i-s:n+=i-l,t.fillRect(e,n,s,l)}function l(t,e){t.strokeStyle=o.background;let n=r.x*i,s=r.y*i,l=i,c=i;1==e?(1==Math.abs(r.dir.y)?(c/=4,s+=1.5*c):(l/=4,n+=1.5*l),t.strokeRect(n,s,l,c)):5==e&&(1==Math.abs(r.dir.y)?(c/=4,s+=1.5*c,l/=2):(l/=4,n+=1.5*l,c/=2),t.strokeRect(n,s,l,c),1==Math.abs(r.dir.y)?n+=l:s+=c,t.strokeRect(n,s,l,c))}function c(t){t.fillStyle=o.background;let e=r.x*i,n=r.y*i,s=.8*i,l=i/5;if(1==Math.abs(r.dir.x)){-1==r.dir.x&&(e+=i,l*=-1);for(let o=0;o<4;o++)e+=l,t.moveTo(e,n+(i-s)/2),t.lineTo(e,n+(i-s)/2+s),s*=.8}else if(1==Math.abs(r.dir.y)){-1==r.dir.y&&(n+=i,l*=-1);for(let o=0;o<4;o++)n+=l,t.moveTo(e+(i-s)/2,n),t.lineTo(e+(i-s)/2+s,n),s*=.8}t.stroke()}return Gt({render:(t,e)=>{const{context:n,width:u,height:a}=t;n.save(),r&&r.type>0&&(1==r.type?(s(n),l(n,1)):2==r.type?s(n):3==r.type?c(n):4==r.type||(5==r.type?(s(n),l(n,5)):6==r.type?function(t){t.fillStyle=o.background;let e=r.x*i,n=r.y*i,s=i,l=i;1==Math.abs(r.dir.y)?(l/=2,-1==r.dir.y&&(n+=l)):(s/=2,-1==r.dir.x&&(e+=s));t.fillRect(e,n,s,l)}(n):7==r.type?(s(n),l(n,1)):8==r.type&&c(n))),n.restore()},height:2}),t.$$set=t=>{"dimension"in t&&n(0,r=t.dimension)},[r]}class re extends yt{constructor(t){super(),gt(this,t,ie,null,s,{dimension:0})}}function se(t){var e=document.createElement("textarea");document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e)}function le(t,e,n){const o=t.slice();return o[3]=e[n],o}function ce(t){let e,n,o,i,r,s,l=t[3].name.substring(0,20)+"",c=t[3].isMaster?"(Master)":"";return{c(){e=k("span"),n=_(l),o=M(),i=_(c),r=M(),s=k("br"),F(e,"text-primary",t[3].isYou)},m(t,l){b(t,e,l),x(e,n),x(e,o),x(e,i),x(e,r),b(t,s,l)},p(t,o){2&o&&l!==(l=t[3].name.substring(0,20)+"")&&S(n,l),2&o&&c!==(c=t[3].isMaster?"(Master)":"")&&S(i,c),2&o&&F(e,"text-primary",t[3].isYou)},d(t){t&&w(e),t&&w(s)}}}function ue(e){let n,o,i;return{c(){n=k("input"),P(n,"class","button primary"),P(n,"type","file")},m(t,r){b(t,n,r),o||(i=N(n,"change",e[2]),o=!0)},p:t,d(t){t&&w(n),o=!1,i()}}}function ae(e){let n,o,i,s,l,c,u,a,d,f,h,m,p=e[1].name+"",g=e[1].playerNames,y=[];for(let t=0;t<g.length;t+=1)y[t]=ce(le(e,g,t));let $=e[1].thisPlayer.isMaster&&!e[1].dungeon.init&&ue(e);return{c(){n=k("div"),o=k("div"),i=k("button"),i.innerHTML='<img alt="Copy Game Link" title="Copy Game Link" src="https://icongr.am/feather/copy.svg?size=16"/>',s=M(),l=k("b"),c=_(p),u=M(),a=k("br"),d=M();for(let t=0;t<y.length;t+=1)y[t].c();f=M(),$&&$.c(),P(i,"class","button icon-only"),P(o,"class","card"),P(n,"class","info svelte-x13rbl")},m(t,p){b(t,n,p),x(n,o),x(o,i),x(o,s),x(o,l),x(l,c),x(l,u),x(o,a),x(o,d);for(let t=0;t<y.length;t+=1)y[t].m(o,null);x(n,f),$&&$.m(n,null),h||(m=N(i,"click",(function(){r(se(e[1].id))&&se(e[1].id).apply(this,arguments)})),h=!0)},p(t,[i]){if(e=t,2&i&&p!==(p=e[1].name+"")&&S(c,p),2&i){let t;for(g=e[1].playerNames,t=0;t<g.length;t+=1){const n=le(e,g,t);y[t]?y[t].p(n,i):(y[t]=ce(n),y[t].c(),y[t].m(o,null))}for(;t<y.length;t+=1)y[t].d(1);y.length=g.length}e[1].thisPlayer.isMaster&&!e[1].dungeon.init?$?$.p(e,i):($=ue(e),$.c(),$.m(n,null)):$&&($.d(1),$=null)},i:t,o:t,d(t){t&&w(n),v(y,t),$&&$.d(),h=!1,m()}}}function de(t,e,n){let o,i;return u(t,wt,(t=>n(1,o=t))),t.$$.update=()=>{if(1&t.$$.dirty&&i&&i[0]){!function(t){let e=new FileReader(t);e.onload=function(t){let n=JSON.parse(e.result),o=0,i=0;for(let t in n.rects){let e=n.rects[t];e.x<o&&(o=e.x),e.y<i&&(i=e.y)}o-=1,i-=1;for(let t in n.rects){let e=n.rects[t];e.x-=o,e.y-=i,e.visible=!1}for(let t in n.doors){let e=n.doors[t];e.x-=o,e.y-=i}n.init=!0,wt.update((t=>(t.dungeon=n,t)))},e.readAsText(t)}(i[0])}},[i,o,function(){i=this.files,n(0,i)}]}class fe extends yt{constructor(t){super(),gt(this,t,de,ae,s,{})}}function he(t,e,n){const o=t.slice();return o[9]=e[n],o[10]=e,o[11]=n,o}function me(t,e,n){const o=t.slice();return o[9]=e[n],o}function pe(t){let e,n,o,i,r;return n=new Wt({props:{$$slots:{default:[xe]},$$scope:{ctx:t}}}),n.$on("click",t[2]),{c(){e=k("div"),ft(n.$$.fragment),P(e,"id","canvasDisplay")},m(s,l){b(s,e,l),ht(n,e,null),o=!0,i||(r=N(e,"mousemove",t[3]),i=!0)},p(t,e){const o={};16387&e&&(o.$$scope={dirty:e,ctx:t}),n.$set(o)},i(t){o||(st(n.$$.fragment,t),o=!0)},o(t){lt(n.$$.fragment,t),o=!1},d(t){t&&w(e),mt(n),i=!1,r()}}}function ge(t){let e,n;return e=new ee({props:{dimension:t[9]}}),{c(){ft(e.$$.fragment)},m(t,o){ht(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.dimension=t[9]),e.$set(o)},i(t){n||(st(e.$$.fragment,t),n=!0)},o(t){lt(e.$$.fragment,t),n=!1},d(t){mt(e,t)}}}function ye(t){let e,n,o;function i(e){t[4].call(null,e,t[9],t[10],t[11])}let r={};return void 0!==t[9]&&(r.dimension=t[9]),e=new re({props:r}),G.push((()=>dt(e,"dimension",i))),{c(){ft(e.$$.fragment)},m(t,n){ht(e,t,n),o=!0},p(o,i){t=o;const r={};!n&&2&i&&(n=!0,r.dimension=t[9],K((()=>n=!1))),e.$set(r)},i(t){o||(st(e.$$.fragment,t),o=!0)},o(t){lt(e.$$.fragment,t),o=!1},d(t){mt(e,t)}}}function $e(t){let e,n,o;function i(e){t[5].call(null,e)}let r={};return void 0!==t[0]&&(r.dimension=t[0]),e=new oe({props:r}),G.push((()=>dt(e,"dimension",i))),{c(){ft(e.$$.fragment)},m(t,n){ht(e,t,n),o=!0},p(t,o){const i={};!n&&1&o&&(n=!0,i.dimension=t[0],K((()=>n=!1))),e.$set(i)},i(t){o||(st(e.$$.fragment,t),o=!0)},o(t){lt(e.$$.fragment,t),o=!1},d(t){mt(e,t)}}}function xe(t){let e,n,o,i,r,s,l,c;e=new Zt({});let u=t[1].dungeon.rects,a=[];for(let e=0;e<u.length;e+=1)a[e]=ge(me(t,u,e));const d=t=>lt(a[t],1,1,(()=>{a[t]=null}));let f=t[1].dungeon.doors,h=[];for(let e=0;e<f.length;e+=1)h[e]=ye(he(t,f,e));const m=t=>lt(h[t],1,1,(()=>{h[t]=null}));r=new Qt({});let p=t[1].thisPlayer.isMaster&&$e(t);return{c(){ft(e.$$.fragment),n=M();for(let t=0;t<a.length;t+=1)a[t].c();o=M();for(let t=0;t<h.length;t+=1)h[t].c();i=M(),ft(r.$$.fragment),s=M(),p&&p.c(),l=E()},m(t,u){ht(e,t,u),b(t,n,u);for(let e=0;e<a.length;e+=1)a[e].m(t,u);b(t,o,u);for(let e=0;e<h.length;e+=1)h[e].m(t,u);b(t,i,u),ht(r,t,u),b(t,s,u),p&&p.m(t,u),b(t,l,u),c=!0},p(t,n){const r={};if(16384&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r),2&n){let e;for(u=t[1].dungeon.rects,e=0;e<u.length;e+=1){const i=me(t,u,e);a[e]?(a[e].p(i,n),st(a[e],1)):(a[e]=ge(i),a[e].c(),st(a[e],1),a[e].m(o.parentNode,o))}for(it(),e=u.length;e<a.length;e+=1)d(e);rt()}if(2&n){let e;for(f=t[1].dungeon.doors,e=0;e<f.length;e+=1){const o=he(t,f,e);h[e]?(h[e].p(o,n),st(h[e],1)):(h[e]=ye(o),h[e].c(),st(h[e],1),h[e].m(i.parentNode,i))}for(it(),e=f.length;e<h.length;e+=1)m(e);rt()}t[1].thisPlayer.isMaster?p?(p.p(t,n),2&n&&st(p,1)):(p=$e(t),p.c(),st(p,1),p.m(l.parentNode,l)):p&&(it(),lt(p,1,1,(()=>{p=null})),rt())},i(t){if(!c){st(e.$$.fragment,t);for(let t=0;t<u.length;t+=1)st(a[t]);for(let t=0;t<f.length;t+=1)st(h[t]);st(r.$$.fragment,t),st(p),c=!0}},o(t){lt(e.$$.fragment,t),a=a.filter(Boolean);for(let t=0;t<a.length;t+=1)lt(a[t]);h=h.filter(Boolean);for(let t=0;t<h.length;t+=1)lt(h[t]);lt(r.$$.fragment,t),lt(p),c=!1},d(t){mt(e,t),t&&w(n),v(a,t),t&&w(o),v(h,t),t&&w(i),mt(r,t),t&&w(s),p&&p.d(t),t&&w(l)}}}function be(t){let e,n,o,i;e=new fe({});let r=t[1].dungeon.init&&pe(t);return{c(){ft(e.$$.fragment),n=M(),r&&r.c(),o=E()},m(t,s){ht(e,t,s),b(t,n,s),r&&r.m(t,s),b(t,o,s),i=!0},p(t,[e]){t[1].dungeon.init?r?(r.p(t,e),2&e&&st(r,1)):(r=pe(t),r.c(),st(r,1),r.m(o.parentNode,o)):r&&(it(),lt(r,1,1,(()=>{r=null})),rt())},i(t){i||(st(e.$$.fragment,t),st(r),i=!0)},o(t){lt(e.$$.fragment,t),lt(r),i=!1},d(t){mt(e,t),t&&w(n),r&&r.d(t),t&&w(o)}}}function we(t,e,n){let o,i,r,s;u(t,wt,(t=>n(1,o=t))),u(t,At,(t=>n(6,i=t))),u(t,Tt,(t=>n(7,r=t))),u(t,Dt,(t=>n(8,s=t)));let l={x:0,y:0,w:1,h:1};return[l,o,function(t){let e=t.detail,n=o.dungeon.rects.find((t=>e.tileX>=t.x&&e.tileX<t.x+t.w&&e.tileY>=t.y&&e.tileY<=t.y+t.h)),i=o.dungeon.doors.find((t=>Math.floor(e.tileX)==t.x&&Math.floor(e.tileY)==t.y));n&&(n.visible?(function(t,e,n){let o={action:"hideRoom",room:t,pid:n,gid:e},i=JSON.stringify(o);Et&&Et.send(i)}(n,o.id,o.thisPlayer.id),i&&function(t,e,n){let o={action:"hideDoor",door:t,pid:n,gid:e},i=JSON.stringify(o);Et&&Et.send(i)}(i,o.id,o.thisPlayer.id)):(function(t,e,n){let o={action:"showRoom",room:t,pid:n,gid:e},i=JSON.stringify(o);Et&&Et.send(i)}(n,o.id,o.thisPlayer.id),i&&function(t,e,n){let o={action:"showDoor",door:t,pid:n,gid:e},i=JSON.stringify(o);Et&&Et.send(i)}(i,o.id,o.thisPlayer.id)))},function(t){let e=(t.clientX+i.dx/r)/s,c=(t.clientY+i.dy/r)/s;n(0,l=o.dungeon.rects.find((t=>e>=t.x&&e<t.x+t.w&&c>=t.y&&c<=t.y+t.h)))},function(t,e,n,i){n[i]=t,wt.set(o)},function(t){l=t,n(0,l)}]}class ve extends yt{constructor(t){super(),gt(this,t,we,be,s,{})}}function ke(t){const e=t-1;return e*e*e+1}function _e(t,{delay:e=0,duration:n=400,easing:o=ke,x:i=0,y:r=0,opacity:s=0}){const l=getComputedStyle(t),c=+l.opacity,u="none"===l.transform?"":l.transform,a=c*(1-s);return{delay:e,duration:n,easing:o,css:(t,e)=>`\n\t\t\ttransform: ${u} translate(${(1-t)*i}px, ${(1-t)*r}px);\n\t\t\topacity: ${c-a*e}`}}function Me(t){let e,n,o,i,r,s,l,c,u,a=t[0].message+"";return{c(){e=k("div"),n=k("span"),o=_(a),i=M(),r=k("button"),r.innerHTML='<img alt="Close Error" title="Close Error" src="https://icongr.am/feather/x.svg?size=16&amp;color=FFFFFF"/>',P(n,"class",""),P(r,"class","button clear icon-only"),P(e,"class","bg-error text-white flex-container svelte-t4cg3o")},m(t,s){b(t,e,s),x(e,n),x(n,o),x(e,i),x(e,r),l=!0,c||(u=N(r,"click",_t),c=!0)},p(t,e){(!l||1&e)&&a!==(a=t[0].message+"")&&S(o,a)},i(t){l||(B((()=>{s||(s=ut(e,_e,{y:-100,opacity:1},!0)),s.run(1)})),l=!0)},o(t){s||(s=ut(e,_e,{y:-100,opacity:1},!1)),s.run(0),l=!1},d(t){t&&w(e),t&&s&&s.end(),c=!1,u()}}}function Ee(t){let e,n,o=t[0].message&&Me(t);return{c(){o&&o.c(),e=E()},m(t,i){o&&o.m(t,i),b(t,e,i),n=!0},p(t,[n]){t[0].message?o?(o.p(t,n),1&n&&st(o,1)):(o=Me(t),o.c(),st(o,1),o.m(e.parentNode,e)):o&&(it(),lt(o,1,1,(()=>{o=null})),rt())},i(t){n||(st(o),n=!0)},o(t){lt(o),n=!1},d(t){o&&o.d(t),t&&w(e)}}}function Ne(t,e,n){let o;return u(t,vt,(t=>n(0,o=t))),[o]}class Pe extends yt{constructor(t){super(),gt(this,t,Ne,Ee,s,{})}}function Se(t){let e,n;return e=new ve({}),{c(){ft(e.$$.fragment)},m(t,o){ht(e,t,o),n=!0},i(t){n||(st(e.$$.fragment,t),n=!0)},o(t){lt(e.$$.fragment,t),n=!1},d(t){mt(e,t)}}}function Oe(t){let e,n;return e=new Rt({}),{c(){ft(e.$$.fragment)},m(t,o){ht(e,t,o),n=!0},i(t){n||(st(e.$$.fragment,t),n=!0)},o(t){lt(e.$$.fragment,t),n=!1},d(t){mt(e,t)}}}function Re(t){let e,n,o,i,r,s;e=new Pe({});const l=[Oe,Se],c=[];function u(t,e){return-1==t[0].id?0:1}return o=u(t),i=c[o]=l[o](t),{c(){ft(e.$$.fragment),n=M(),i.c(),r=E()},m(t,i){ht(e,t,i),b(t,n,i),c[o].m(t,i),b(t,r,i),s=!0},p(t,[e]){let n=o;o=u(t),o!==n&&(it(),lt(c[n],1,1,(()=>{c[n]=null})),rt(),i=c[o],i?i.p(t,e):(i=c[o]=l[o](t),i.c()),st(i,1),i.m(r.parentNode,r))},i(t){s||(st(e.$$.fragment,t),st(i),s=!0)},o(t){lt(e.$$.fragment,t),lt(i),s=!1},d(t){mt(e,t),t&&w(n),c[o].d(t),t&&w(r)}}}function Fe(t,e,n){let o;var i;return u(t,wt,(t=>n(0,o=t))),i=()=>{!function(t,e){let n={action:"playerLeave",pid:e,gid:t},o=JSON.stringify(n);Et&&Et.send(o)}(o.id,o.thisPlayer.id)},j().$$.on_destroy.push(i),[o]}return new class extends yt{constructor(t){super(),gt(this,t,Fe,Re,s,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
